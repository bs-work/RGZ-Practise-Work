
<div class="container mt-4 main-card">
    <h2>Some Cards</h2>
    <div class="mt-4 added-card">
      <div *ngFor="let card of cards; let i = index" class="card mb-2">
        <div class="card-body">
          <form [formGroup]="card" (ngSubmit)="submit()">
            <div class="form-group">
              <label>Name <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span></label>
              <input formControlName="name" 
                     class="form-control" 
                     [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                     placeholder="Enter name"/>
            </div>
  
            <div class="form-group">
              <label>Dropdown <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span></label>
              <ng-multiselect-dropdown
                [placeholder]="'Select options'"
                [settings]="dropdownSettings"
                [data]="dropdownList"
                [(ngModel)]="selectedItems"
                (onSelect)="onItemSelect($event)">
                <!-- (onSelectAll)="onSelectAll($event)"> -->
              </ng-multiselect-dropdown>
              <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
                Please select at least one option.
              </div>
            </div>
            
            <div class="form-group">
              <label>Date <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span></label>
              <input type="date" formControlName="date" 
                     class="form-control" 
                     [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"/>
            </div>
  
            <div class="form-group">
              <label for="myfile">Upload File</label>
              <input type="file" id="myfile" name="myfile">
            </div>
            
            <div class="btns">
              <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button> 
              <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
              <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgMultiSelectDropDownModule, IDropdownSettings } from 'ng-multiselect-dropdown';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgMultiSelectDropDownModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})
export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submitted: boolean = false;
  dropdownList: DropdownItem[] = [];
  selectedItems: DropdownItem[] = [];
  dropdownSettings: IDropdownSettings = {};

  constructor(private fb: FormBuilder) {
    this.addCard();
  }

  ngOnInit() {

    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' },
    ];

    this.selectedItems = [];
 
    this.dropdownSettings = {
      singleSelection: true,
      idField: 'item_id',
      textField: 'item_text',
      selectAllText: '',
      unSelectAllText: '',
      itemsShowLimit: 3,
      allowSearchFilter: false
    };
  }

  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', Validators.required],
      dropdown: [[], Validators.required],  
      date: ['', Validators.required],
    });
  }

  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
  }

  deleteCard(index: number) {
    if (index === 0) {
      alert('The main card cannot be deleted.');
      return;
    }
    this.cards.splice(index, 1);
  }

  onItemSelect(item: any) {
    console.log('Selected item:', item);
    const cardIndex = this.cards.length - 1; 
    this.cards[cardIndex].get('dropdown')?.setValue(this.selectedItems);
  }

  // onSelectAll(items: any) {
  //   console.log('All selected items:', items);
  //   const cardIndex = this.cards.length - 1;
  //   this.cards[cardIndex].get('dropdown')?.setValue(this.selectedItems);
  // }

  submit() {
    this.submitted = true;
    this.cards.forEach((card, index) => {
      if (card.valid) {
        console.log(`Card ${index + 1}:`, card.value);
      } else {
        console.log(`Card ${index + 1} is invalid.`);
      }
    });
  }
}

<div class="container mt-4 main-card">
    <h2>Some Cards</h2>
    <div class="mt-4 added-card">
      <div *ngFor="let card of cards; let i = index" class="card mb-2">
        <div class="card-body">
          <form [formGroup]="card" (ngSubmit)="submit()">
            <div class="form-group">
              <label>Name <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span></label>
              <input formControlName="name" 
                     class="form-control" 
                     [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                     placeholder="Enter name"/>
            </div>
  
            <div class="form-group">
              <label>Dropdown <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span></label>
              <ng-multiselect-dropdown
                [placeholder]="'Select options'"
                [settings]="dropdownSettings"
                [data]="dropdownList"
                [(ngModel)]="selectedItems"
                (onSelect)="onItemSelect($event)">
              </ng-multiselect-dropdown>
              <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
                Please select at least one option.
              </div>
            </div>
  
            <div class="form-group">
              <label>Date <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span></label>
              <input type="date" formControlName="date" 
                     class="form-control" 
                     [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"/>
            </div>
  
            <div class="btns">
              <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button> 
              <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
              <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <div class="mt-4">
      <h3>Submitted Cards</h3>
      <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
        <div class="card-body">
          <p><strong>Card {{ j + 1 }}</strong></p>
          <p>Name: {{ submittedCard.name }}</p>
          <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
          <p>Date: {{ submittedCard.date }}</p>
        </div>
      </div>
    </div>
  </div>
  import { Component, OnInit } from '@angular/core';
  import { FormBuilder, FormGroup, Validators } from '@angular/forms';
  import { FormsModule } from '@angular/forms';
  import { CommonModule } from '@angular/common';
  import { ReactiveFormsModule } from '@angular/forms';
  import { NgMultiSelectDropDownModule, IDropdownSettings } from 'ng-multiselect-dropdown';
  
  interface DropdownItem {
    item_id: number;
    item_text: string;
  }
  
  @Component({
    selector: 'app-form-card',
    standalone: true,
    imports: [FormsModule, CommonModule, ReactiveFormsModule, NgMultiSelectDropDownModule],
    templateUrl: './form-card.component.html',
    styleUrls: ['./form-card.component.css']
  })
  export class FormCardComponent implements OnInit {
    cards: FormGroup[] = [];
    submitted: boolean = false;
    submittedCards: any[] = [];
    dropdownList: DropdownItem[] = [];
    selectedItems: DropdownItem[] = [];
    dropdownSettings: IDropdownSettings = {};
  
    constructor(private fb: FormBuilder) {
      this.addCard();
    }
  
    ngOnInit() {
      this.dropdownList = [
        { item_id: 1, item_text: 'Option 1' },
        { item_id: 2, item_text: 'Option 2' },
        { item_id: 3, item_text: 'Option 3' },
      ];
  
      this.dropdownSettings = {
        singleSelection: true,
        idField: 'item_id',
        textField: 'item_text',
        selectAllText: '',
        unSelectAllText: '',
        itemsShowLimit: 3,
        allowSearchFilter: false
      };
    }
  
    createCardForm(): FormGroup {
      return this.fb.group({
        name: ['', Validators.required],
        dropdown: [[], Validators.required],
        date: ['', Validators.required],
      });
    }
  
    addCard() {
      const newCard = this.createCardForm();
      this.cards.push(newCard);
    }
  
    deleteCard(index: number) {
      if (index === 0) {
        alert('The main card cannot be deleted.');
        return;
      }
      this.cards.splice(index, 1);
    }
  
    onItemSelect(item: any) {
      console.log('Selected item:', item);
      const cardIndex = this.cards.length - 1;
      this.cards[cardIndex].get('dropdown')?.setValue(this.selectedItems);
    }
  
    submit() {
      this.submitted = true;
      this.submittedCards = [];
      this.cards.forEach((card, index) => {
        if (card.valid) {
          this.submittedCards.push({
            name: card.value.name,
            dropdown: card.value.dropdown,
            date: card.value.date
          });
        } else {
          console.log(`Card ${index + 1} is invalid.`);
        }
      });
    }
    
  }
    
<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit()">
          <div class="form-group">
            <label>Name <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span></label>
            <input formControlName="name" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                   placeholder="Enter name"/>
          </div>

          <div class="form-group">
            <label>Dropdown <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span></label>
            <ng-multiselect-dropdown
              [placeholder]="'Select options'"
              [settings]="dropdownSettings"
              [data]="dropdownList"
              [(ngModel)]="selectedItems"
              (onSelect)="onItemSelect($event)"
              (onSelectAll)="onSelectAll($event)">
            </ng-multiselect-dropdown>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>
          
          <div class="form-group">
            <label>Date <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span></label>
            <input type="date" formControlName="date" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"/>
          </div>

          <div class="form-group">
            <label for="myfile">Upload File</label>
            <input type="file" id="myfile" name="myfile">
          </div>
          
          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button> 
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt" [disabled]="card.invalid">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgMultiSelectDropDownModule, IDropdownSettings } from 'ng-multiselect-dropdown';

// Define the DropdownItem interface
interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgMultiSelectDropDownModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})
export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submitted: boolean = false;

  // Dropdown configuration
  dropdownList: DropdownItem[] = [];
  selectedItems: DropdownItem[] = [];
  dropdownSettings: IDropdownSettings = {};

  constructor(private fb: FormBuilder) {
    this.addCard();
  }

  ngOnInit() {
    // Define dropdown options
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' },
    ];

    // Initialize selected items (if any)
    this.selectedItems = [];

    // Dropdown settings
    this.dropdownSettings = {
      singleSelection: false,
      idField: 'item_id',
      textField: 'item_text',
      selectAllText: 'Select All',
      unSelectAllText: 'Unselect All',
      itemsShowLimit: 3,
      allowSearchFilter: true
    };
  }

  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', Validators.required],
      dropdown: [[], Validators.required],  
      date: ['', Validators.required],
    });
  }

  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
  }

  deleteCard(index: number) {
    if (index === 0) {
      alert('The main card cannot be deleted.');
      return;
    }
    this.cards.splice(index, 1);
  }

  // Update the parameter type to match the emitted event
  onItemSelect(item: any) {
    console.log('Selected item:', item);
    const cardIndex = this.cards.length - 1; // Use the correct index as needed
    this.cards[cardIndex].get('dropdown')?.setValue(this.selectedItems);
  }

  // Update the parameter type to match the emitted event
  onSelectAll(items: any) {
    console.log('All selected items:', items);
    const cardIndex = this.cards.length - 1; // Use the correct index as needed
    this.cards[cardIndex].get('dropdown')?.setValue(this.selectedItems);
  }

  submit() {
    this.submitted = true;
    this.cards.forEach((card, index) => {
      if (card.valid) {
        console.log(`Card ${index + 1}:`, card.value);
      } else {
        console.log(`Card ${index + 1} is invalid.`);
      }
    });
  }
}

<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit()">
          <div class="form-group">
            <label>Name <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span></label>
            <input formControlName="name" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                   placeholder="Enter name"/>
          </div>

          <div class="form-group">
            <label>Dropdown <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span></label>
            <ng-multiselect-dropdown
              [placeholder]="'Select options'"
              [settings]="dropdownSettings"
              [data]="dropdownList"
              [(ngModel)]="selectedItems"
              (onSelect)="onItemSelect($event)"

              [ngModelOptions]="{standalone: true}">
            </ng-multiselect-dropdown>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>
          
          <div class="form-group">
            <label>Date <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span></label>
            <input type="date" formControlName="date" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"/>
          </div>

          <div class="form-group">
            <label for="myfile" (click)="uploadfile">Upload File</label>
            <input type="file" id="myfile" name="myfile">
          </div>

          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button> 
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <div class="mt-4">
    <h3>Submitted Cards</h3>
    <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
      <div class="card-body">
        <p><strong>Card {{ j + 1 }}</strong></p>
        <p>Name: {{ submittedCard.name }}</p>
        <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
        <p>Date: {{ submittedCard.date }}</p>
        <P>Uploaded File : {{ submittedCard.uploadfile}}</P>
      </div>
    </div>
  </div>
</div>


import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgMultiSelectDropDownModule, IDropdownSettings } from 'ng-multiselect-dropdown';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgMultiSelectDropDownModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: DropdownItem[] = [];
  dropdownSettings: IDropdownSettings = {};

  constructor(private fb: FormBuilder) {
    this.addCard();
  }

  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' },
    ];

    this.dropdownSettings = {
      // singleSelection: false,
      idField: 'item_id',
      textField: 'item_text',
      // selectAllText: 'Select All',
      // unSelectAllText: 'Unselect All',
      // itemsShowLimit: 3,
      // allowSearchFilter: true
    };
  }

  onItemSelect(item: any) {
    const cardIndex = this.cards.length - 1; 
    this.cards[cardIndex].get('dropdown')?.setValue(this.selectedItems.map(i => i.item_id));
  }

  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', Validators.required],
      dropdown: [[], Validators.required],  
      date: ['', Validators.required],
    });
  }

  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
  }

  deleteCard(index: number) {
    if (index === 0) {
      alert('The main card cannot be deleted.');
      return;
    }
    this.cards.splice(index, 1);
  }

  uploadfile(){

  }
  

  // onSelectAll(items: any) {
  //   const cardIndex = this.cards.length - 1; 
  //   this.cards[cardIndex].get('dropdown')?.setValue(this.selectedItems.map(i => i.item_id));
  // }

  submit() {
    this.submittedCards = []; 
    this.cards.forEach((card) => {
      if (card.valid) {
        this.submittedCards.push({
          name: card.value.name,
          dropdown: card.value.dropdown,
          date: card.value.date,
          uploadfile:card.value.uploadfile
        });
      }
    });
  }
}                                                           


<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">
          <div class="form-group">
            <label>Name <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span></label>
            <input formControlName="name" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                   placeholder="Enter name"/>
          </div>
          
          <div class="form-group">
            <label>Dropdown <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span></label>
            <ng-select 
              [items]="dropdownList"  
              bindLabel="item_text"  
              bindValue="item_id"
              [(ngModel)]="selectedItems[i]"
              [multiple]="true"  
              placeholder="Select options"
              (change)="onItemSelect($event, i)" 
              [clearable]="true" 
              [closeOnSelect]="false"
              [ngModelOptions]="{standalone: true}">
            </ng-select>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>

          <div class="form-group">
            <label>Date <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span></label>
            <input type="date" formControlName="date" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"/>
          </div>

          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile">
            <div *ngIf="fileNames[i]" class="mt-2">
              <strong>Uploaded File:</strong> {{ fileNames[i] }}
            </div>
          </div>

          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button> 
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <div class="mt-4">
    <h3>Submitted Cards</h3>
    <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
      <div class="card-body">
        <p><strong>Card {{ j + 1 }}</strong></p>
        <p>Name: {{ submittedCard.name }}</p>
        <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
        <p>Date: {{ submittedCard.date }}</p>
        <P>Uploaded File : {{ submittedCard.uploadfile || 'No file uploaded' }}</P>
      </div>
    </div>
  </div>
</div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgLabelTemplateDirective, NgOptionTemplateDirective, NgSelectComponent } from '@ng-select/ng-select';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule,NgLabelTemplateDirective,
    NgOptionTemplateDirective,
    NgSelectComponent,],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];  
  fileNames: string[] = [];  

  constructor(private fb: FormBuilder) {
    this.addCard();
  }

  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

  onItemSelect(item: any, index: number) {
    this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  }

  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', Validators.required],
      dropdown: [[], Validators.required],  
      date: ['', Validators.required],
    });
  }

  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]);  
    this.fileNames.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      alert('The main card cannot be deleted.');
      return;
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      this.fileNames[index] = file.name; 
    }
  }

  submit(index: number) {
    if (this.cards[index].valid) {
      this.submittedCards.push({
        name: this.cards[index].value.name,
        dropdown: this.cards[index].value.dropdown,
        date: this.cards[index].value.date,
        uploadfile: this.fileNames[index] || 'No file uploaded'
      });
      this.fileNames[index] = ''; 
      alert('Form submitted successfully!');
    }
  }
}


on submit check for all that details like name dropdown and date and upload files are done if not shows error on all placeholder when user clicks on submit 
<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">
          <div class="form-group">
            <label>Name <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span></label>
            <input formControlName="name" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                   placeholder="Enter name"/>
          </div>
          
          <div class="form-group">
            <label>Dropdown <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span></label>
            <ng-select 
              [items]="dropdownList"  
              bindLabel="item_text"  
              bindValue="item_id"
              [(ngModel)]="selectedItems[i]"
              [multiple]="true"  
              placeholder="Select options"
              (change)="onItemSelect($event, i)" 
              [clearable]="true" 
              [closeOnSelect]="true "
              [ngModelOptions]="{standalone: true}"
              [compareWith]="compareWith">  
            </ng-select>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>

          <div class="form-group">
            <label>Date <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span></label>
            <input type="date" formControlName="date" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"/>
          </div>

          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile">
            <div *ngIf="fileNames[i]" class="mt-2">
              <strong>Uploaded File:</strong> {{ fileNames[i] }}
            </div>
          </div>

          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button> 
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
        
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <div class="mt-4">
    <h3>Submitted Cards</h3>
    <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
      <div class="card-body">
        <p><strong>Card {{ j + 1 }}</strong></p>
        <p>Name: {{ submittedCard.name }}</p>
        <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
        <p>Date: {{ submittedCard.date }}</p>
        <P>Uploaded File : {{ submittedCard.uploadfile || 'No file uploaded' }}</P>
      </div>
    </div>
  </div>
</div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgLabelTemplateDirective, NgOptionTemplateDirective, NgSelectComponent } from '@ng-select/ng-select';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule,NgLabelTemplateDirective,
    NgOptionTemplateDirective,
    NgSelectComponent,],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];  

  constructor(private fb: FormBuilder) {
    this.addCard();  
  }

  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  }

  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', Validators.required],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push(''); 
  }

  deleteCard(index: number) {
    if (index === 0) {
      alert('The main card cannot be deleted.');
      return;
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1);  
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      this.fileNames[index] = file.name;
    }
  }

  submit(index: number) {
    if (this.cards[index].valid) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
        return this.dropdownList.find(item => item.item_id === id)?.item_text || 'Unknown';
      });
      this.submittedCards.push({
        name: cardValue.name,
        dropdown: dropdownTexts,
        date: cardValue.date,
        uploadfile: this.fileNames[index] || 'No file uploaded'
      });
      this.fileNames[index] = ''; 
      this.selectedItems[index] = [];
      alert('Form submitted successfully!');
    }
  }
}


clear the value of file after submit

<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">
          <!-- Name Field -->
          <div class="form-group">
            <label>Name 
              <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span>
            </label>
            <input formControlName="name" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                   placeholder="Enter name"/>
            <div *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">
              Please enter a name.
            </div>
          </div>

          <!-- Dropdown Field -->
          <div class="form-group">
            <label>Dropdown 
              <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
            </label>
            <ng-select 
              [items]="dropdownList"  
              bindLabel="item_text"  
              bindValue="item_id"
              [(ngModel)]="selectedItems[0]"
              [multiple]="true"  
              placeholder="Select options"
              (change)="onItemSelect($event, i)" 
              [clearable]="true" 
              [closeOnSelect]="true"
              [ngModelOptions]="{standalone: true}"
              [compareWith]="compareWith">  
            </ng-select>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>

          <!-- Date Field -->
          <div class="form-group">
            <label>Date 
              <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span>
            </label>
            <input type="date" formControlName="date" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"/>
            <div *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">
              Please select a date.
            </div>
          </div>

          <!-- File Upload Field -->
          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile" 
                   [ngClass]="{'is-invalid': !fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched}"/>
            <div *ngIf="fileNames[i]" class="mt-2">
              <strong>Uploaded File:</strong> {{ fileNames[i] }}
            </div>
            <div *ngIf="!fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched" class="text-danger">
              Please upload a file.
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button> 
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Submitted Cards Section -->
  <div class="mt-4">
    <h3>Submitted Cards</h3>
    <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
      <div class="card-body">
        <p><strong>Card {{ j + 1 }}</strong></p>
        <p>Name: {{ submittedCard.name }}</p>
        <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
        <p>Date: {{ submittedCard.date }}</p>
        <p>Uploaded File: {{ submittedCard.uploadfile || 'No file uploaded' }}</p>
        
        <!-- Edit Button -->
        <button type="button" 
                class="btn btn-warning" 
                (click)="editSelectedCard(j)">
          Edit
        </button>
        
        <!-- Delete Button -->
        <button type="button" 
                class="btn btn-danger"
                (click)="deleteSelectedCard(j)">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  }

  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', Validators.required],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push(''); 
  }

  deleteCard(index: number) {
    if (index === 0) {
      alert('The main card cannot be deleted.');
      return;
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1);  
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      this.fileNames[index] = file.name;
    }
  }

  submit(index: number) {
    if (this.cards[index].valid) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
        return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });
  
      if (this.editingIndex !== null) {
        this.submittedCards[this.editingIndex] = {
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded'
        };
        this.editingIndex = null;
        alert('Card updated successfully!');
      } else {
        this.submittedCards.push({
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded'
        });
        alert('Card submitted successfully!');
      }
      this.cards[index].reset({
        name: '',
        dropdown: [],
        date: ''
      });
      this.selectedItems[index] = []; 
  this.fileNames[index] = ''; 
  const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`);
  if (fileInput instanceof HTMLInputElement) {
    fileInput.value = ''; 
  }
    }
  }

  editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index; 
    const dropdownIds = cardToEdit.dropdown.map((text: string) => {
      const matchingItem = this.dropdownList.find(item => item.item_text === text);
      return matchingItem ? matchingItem.item_id : null;
    }).filter((id: null) => id !== null);
    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: dropdownIds,
      date: cardToEdit.date
    });

    // this.selectedItems[0] = dropdownIds.map((id: number) => {
    //   const matchingItem = this.dropdownList.find(item => item.item_id === id);
    //   return matchingItem ? matchingItem.item_text : '';
    // });
  }
  
  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
    alert('Card deleted successfully!');
  }
}

<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">
          <!-- Name Field -->
          <div class="form-group">
            <label>Name 
              <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span>
            </label>
            <input formControlName="name" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                   placeholder="Enter name"/>
            <div *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">
              Please enter a name.
            </div>
          </div>

          <!-- Dropdown Field -->
          <div class="form-group">
            <label>Dropdown 
              <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
            </label>
            <ng-select 
              [items]="dropdownList"  
              bindLabel="item_text"  
              bindValue="item_id"
              [(ngModel)]="selectedItems[0]"
              [multiple]="true"  
              placeholder="Select options"
              (change)="onItemSelect($event, i)" 
              [clearable]="true" 
              [closeOnSelect]="true"
              [ngModelOptions]="{standalone: true}"
              [compareWith]="compareWith">  
            </ng-select>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>

          <!-- Date Field -->
          <div class="form-group">
            <label>Date 
              <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span>
            </label>
            <input type="date" formControlName="date" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"/>
            <div *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">
              Please select a date.
            </div>
          </div>

          <!-- File Upload Field -->
          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile" [attr.data-index]="i"/>
                   <!-- [ngClass]="{'is-invalid': !fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched}"/> -->
            <div *ngIf="fileNames[i]" class="mt-2">
              <strong>Uploaded File:</strong> {{fileNames[i]}}
            </div>
            <div *ngIf="!fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched" class="text-danger">
              Please upload a file
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button> 
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Submitted Cards Section -->
  <div class="mt-4">
    <h3>Submitted Cards</h3>
    <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
      <div class="card-body">
        <p><strong>Card {{ j + 1 }}</strong></p>
        <p>Name: {{ submittedCard.name }}</p>
        <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
        <p>Date: {{ submittedCard.date }}</p>
        <p>Uploaded File: {{ submittedCard.uploadfile || 'No file uploaded' }}</p>
        
        <!-- Edit Button -->
        <button type="button" 
                class="btn btn-warning" 
                (click)="editSelectedCard(j)">
          Edit
        </button>
        
        <!-- Delete Button -->
        <button type="button" 
                class="btn btn-danger"
                (click)="deleteSelectedCard(j)">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>


import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  }

  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', Validators.required],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push(''); 
  }

  deleteCard(index: number) {
    if (index === 0) {
      alert('The main card cannot be deleted.');
      return;
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1);  
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      this.fileNames[index] = file.name;
    }
  }

  submit(index: number) {
    if (this.cards[index].valid) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
        return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });
  
      if (this.editingIndex !== null) {
        this.submittedCards[this.editingIndex] = {
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded'
        };
        this.editingIndex = null;
        alert('Card updated successfully!');
      } else {
        this.submittedCards.push({
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded'
        });
        alert('Card submitted successfully!');
      }
      this.cards[index].reset({
        name: '',
        dropdown: [],
        date: ''
      });
      this.selectedItems[index] = []; 
      this.fileNames[index] = ''; 
      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
        fileInput.value = ''; 
      }
    }
  }
  

  editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index; 
    const dropdownIds = cardToEdit.dropdown.map((text: string) => {
      const matchingItem = this.dropdownList.find(item => item.item_text === text);
      return matchingItem ? matchingItem.item_id : null;
    }).filter((id: null) => id !== null);
    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: dropdownIds,
      date: cardToEdit.date
    });

    // this.selectedItems[0] = dropdownIds.map((id: number) => {
    //   const matchingItem = this.dropdownList.find(item => item.item_id === id);
    //   return matchingItem ? matchingItem.item_text : '';
    // });
  }
  
  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
    alert('Card deleted successfully!');
  }
}


<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">
          <!-- Name Field -->
          <div class="form-group">
            <label>Name 
              <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span>
            </label>
            <input formControlName="name" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                   [placeholder]="card.get('name')?.invalid && card.get('name')?.touched ? 'Name is required' : 'Enter name'"/>
            <div *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">
              Please enter a name.
            </div>
          </div>

          <!-- Dropdown Field -->
          <div class="form-group">
            <label>Dropdown 
              <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
            </label>
            <ng-select 
              [items]="dropdownList"  
              bindLabel="item_text"  
              bindValue="item_id"
              [(ngModel)]="selectedItems[0]"
              [multiple]="true"  
              placeholder="Select options"
              (change)="onItemSelect($event, i)" 
              [clearable]="true" 
              [closeOnSelect]="true"
              [ngModelOptions]="{standalone: true}"
              [compareWith]="compareWith">  
            </ng-select>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>

          <!-- Date Field -->
          <div class="form-group">
            <label>Date 
              <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span>
            </label>
            <input type="date" formControlName="date" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"
                   [placeholder]="card.get('date')?.invalid && card.get('date')?.touched ? 'Date is required' : ''"/>
            <div *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">
              Please select a date.
            </div>
          </div>

          <!-- File Upload Field -->
          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile" [attr.data-index]="i"
                   [placeholder]="fileNames[i] ? 'File uploaded' : 'Please upload a file'" class="form-control" />
            <div *ngIf="!fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched" class="text-danger">
              Please upload a file
            </div>
            <div *ngIf="fileNames[i]" class="mt-2">
              <strong>Uploaded File:</strong> {{fileNames[i]}}
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button> 
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Submitted Cards Section -->
  <div class="mt-4">
    <h3>Submitted Cards</h3>
    <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
      <div class="card-body">
        <p><strong>Card {{ j + 1 }}</strong></p>
        <p>Name: {{ submittedCard.name }}</p>
        <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
        <p>Date: {{ submittedCard.date }}</p>
        <p>Uploaded File: {{ submittedCard.uploadfile || 'No file uploaded' }}</p>
        
        <!-- Edit Button -->
        <button type="button" 
                class="btn btn-warning" 
                (click)="editSelectedCard(j)">
          Edit
        </button>
        
        <!-- Delete Button -->
        <button type="button" 
                class="btn btn-danger"
                (click)="deleteSelectedCard(j)">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  }

  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', Validators.required],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push(''); 
  }

  deleteCard(index: number) {
    if (index === 0) {
      alert('The main card cannot be deleted.');
      return;
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1);  
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      this.fileNames[index] = file.name;
    }
  }

  submit(index: number) {
    // Manually mark all controls as touched to trigger validation
    const controls = this.cards[index].controls;
  
    // Mark each control as touched
    for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
        controls[control].markAsTouched();
      }
    }
  
    // If the form is valid, submit the card
    if (this.cards[index].valid) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
        return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });
  
      // Handle card update or addition
      if (this.editingIndex !== null) {
        this.submittedCards[this.editingIndex] = {
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded'
        };
        this.editingIndex = null;
        alert('Card updated successfully!');
      } else {
        this.submittedCards.push({
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded'
        });
        alert('Card submitted successfully!');
      }
  
      // Reset the form after successful submission
      this.cards[index].reset({
        name: '',
        dropdown: [],
        date: ''
      });
      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
  
      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
        fileInput.value = '';
      }
    }
  }
  
  
-------------

handleFileInput(event: any, index: number) {
  const file = event.target.files[0];
  if (file) {
    this.fileNames[index] = file.name;

    // Create a preview URL for the uploaded file (for images)
    const reader = new FileReader();
    reader.onload = (e: any) => {
      this.filePreviews[index] = e.target.result;
    };
    reader.readAsDataURL(file); // This will generate the base64 preview of the image
  }
}

submit(index: number) {
  // Mark all controls as touched to trigger validation
  const controls = this.cards[index].controls;
  for (const control in controls) {
    if (controls.hasOwnProperty(control)) {
      controls[control].markAsTouched();
    }
  }

  // If the form is valid, submit the card
  if (this.cards[index].valid) {
    const cardValue = this.cards[index].value;
    const dropdownTexts = cardValue.dropdown.map((id: number) => {
      return this.dropdownList.find(item => item.item_id === id)?.item_text;
    });

    // Handle card update or addition
    if (this.editingIndex !== null) {
      this.submittedCards[this.editingIndex] = {
        name: cardValue.name,
        dropdown: dropdownTexts,
        date: cardValue.date,
        uploadfile: this.fileNames[index] || 'No file uploaded',
        filePreview: this.filePreviews[index] || '' // Store the preview URL for the submitted card
      };
      this.editingIndex = null;
      alert('Card updated successfully!');
    } else {
      this.submittedCards.push({
        name: cardValue.name,
        dropdown: dropdownTexts,
        date: cardValue.date,
        uploadfile: this.fileNames[index] || 'No file uploaded',
        filePreview: this.filePreviews[index] || '' // Store the preview URL for the submitted card
      });
      alert('Card submitted successfully!');
    }

    // Reset the form after successful submission
    this.cards[index].reset({
      name: '',
      dropdown: [],
      date: ''
    });
    this.selectedItems[index] = [];
    this.fileNames[index] = ''; 
    this.filePreviews[index] = ''; // Clear the file preview after submission
    const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
    if (fileInput) {
      fileInput.value = '';
    }
  }
}

editSelectedCard(index: number) {
  const cardToEdit = this.submittedCards[index];
  this.editingIndex = index; 
  const dropdownIds = cardToEdit.dropdown.map((text: string) => {
    const matchingItem = this.dropdownList.find(item => item.item_text === text);
    return matchingItem ? matchingItem.item_id : null;
  }).filter((id: null) => id !== null);
  this.cards[0].patchValue({
    name: cardToEdit.name,
    dropdown: dropdown

// handleFileInput(event: any, index: number) {
//   const file = event.target.files[0];
//   if (file) {
//     this.fileNames[index] = file.name;

//     // Create a preview URL for the uploaded file (for images)
//     const reader = new FileReader();
//     reader.onload = (e: any) => {
//       this.filePreviews[index] = e.target.result;
//     };
//     reader.readAsDataURL(file); // This will generate the base64 preview of the image
//   }
// }

<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">
          <!-- Name Field -->
          <div class="form-group">
            <label>Name 
              <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span>
            </label>
            <input formControlName="name" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                   [placeholder]="card.get('name')?.invalid && card.get('name')?.touched ? 'Name is required' : 'Enter name'"/>
            <div *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">
              Please enter a name.
            </div>
          </div>

          <!-- Dropdown Field -->
          <div class="form-group">
            <label>Dropdown 
              <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
            </label>
            <ng-select 
              [items]="dropdownList"  
              bindLabel="item_text"  
              bindValue="item_id"
              [(ngModel)]="selectedItems[0]"
              [multiple]="true"  
              placeholder="Select options"
              (change)="onItemSelect($event, i)" 
              [clearable]="true" 
              [closeOnSelect]="true"
              [ngModelOptions]="{standalone: true}">  
            </ng-select>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>

          <!-- Date Field -->
          <div class="form-group">
            <label>Date 
              <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span>
            </label>
            <input type="date" formControlName="date" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"
                   [placeholder]="card.get('date')?.invalid && card.get('date')?.touched ? 'Date is required' : ''"/>
            <div *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">
              Please select a date.
            </div>
          </div>

          <!-- File Upload Field -->
          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" 
                   id="myfile-{{i}}" name="myfile" 
                   [attr.data-index]="i"
                   [placeholder]="fileNames[i] ? 'File uploaded' : 'Please upload a file'" 
                   class="form-control" />
            <div *ngIf="!fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched" class="text-danger">
              Please upload a file
            </div>
            <div *ngIf="fileNames[i]" class="mt-2">
              <strong>Uploaded File:</strong> {{fileNames[i]}}
            </div>
            <!-- File Preview (only if available) -->
            <div *ngIf="filePreviews[i]" class="mt-2">
              <img [src]="filePreviews[i]" alt="File preview" class="img-fluid" />
            </div>
          </div>

          <button type="submit" class="btn btn-primary" [disabled]="card.invalid">Submit</button>
        </form>
      </div>
    </div>
  </div>

  <div *ngIf="submittedCards.length > 0" class="mt-4">
    <h3>Submitted Cards</h3>
    <div *ngFor="let submittedCard of submittedCards; let i = index">
      <div class="card mb-3">
        <div class="card-body">
          <h5>{{submittedCard.name}}</h5>
          <p>{{submittedCard.date}}</p>
          <div *ngIf="submittedCard.filePreview">
            <img [src]="submittedCard.filePreview" alt="File preview" class="img-fluid" />
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


submit(index: number) {
  // Manually mark all controls as touched to trigger validation
  const controls = this.cards[index].controls;
  for (const control in controls) {
    if (controls.hasOwnProperty(control)) {
      controls[control].markAsTouched();
    }
  }

  // If the form is valid, submit the card
  if (this.cards[index].valid) {
    const cardValue = this.cards[index].value;
    const dropdownTexts = cardValue.dropdown.map((id: number) => {
      return this.dropdownList.find(item => item.item_id === id)?.item_text;
    });

    // Handle card update or addition
    if (this.editingIndex !== null) {
      this.submittedCards[this.editingIndex] = {
        name: cardValue.name,
        dropdown: dropdownTexts,
        date: cardValue.date,
        uploadfile: this.fileNames[index] || 'No file uploaded',
        filePreview: this.filePreviews[index] || '' // Store the preview URL for the submitted card
      };
      this.editingIndex = null;
      alert('Card updated successfully!');
    } else {
      this.submittedCards.push({
        name: cardValue.name,
        dropdown: dropdownTexts,
        date: cardValue.date,
        uploadfile: this.fileNames[index] || 'No file uploaded',
        filePreview: this.filePreviews[index] || '' // Store the preview URL for the submitted card
      });
      alert('Card submitted successfully!');
    }

    // Reset the form after successful submission
    this.cards[index].reset({
      name: '',
      dropdown: [],
      date: ''
    });
    this.selectedItems[index] = [];
    this.fileNames[index] = ''; 
    this.filePreviews[index] = ''; // Clear the file preview after submission
    const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
    if (fileInput) {
      fileInput.value = '';
    }
  }
}
<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">
          <!-- Name Field -->
          <div class="form-group">
            <label>Name 
              <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span>
            </label>
            <input formControlName="name" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                   [placeholder]="card.get('name')?.invalid && card.get('name')?.touched ? 'Name is required' : 'Enter name'"/>
            <div *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">
              Please enter a name.
            </div>
          </div>

          <!-- Dropdown Field -->
          <div class="form-group">
            <label>Dropdown 
              <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
            </label>
            <ng-select 
              [items]="dropdownList"  
              bindLabel="item_text"  
              bindValue="item_id"
              [(ngModel)]="selectedItems[i]"
              [multiple]="true"  
              placeholder="Select options"
              (change)="onItemSelect($event, i)" 
              [clearable]="true" 
              [closeOnSelect]="true"
              [ngModelOptions]="{standalone: true}"
              [compareWith]="compareWith">  
            </ng-select>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>

          <!-- Date Field -->
          <div class="form-group">
            <label>Date 
              <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span>
            </label>
            <input type="date" formControlName="date" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"
                   [placeholder]="card.get('date')?.invalid && card.get('date')?.touched ? 'Date is required' : ''"/>
            <div *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">
              Please select a date.
            </div>
          </div>

          <!-- Upload File Section -->
          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile" [attr.data-index]="i"
                   [placeholder]="fileNames[i] ? 'File uploaded' : 'Please upload a file'" class="form-control" />
            <div *ngIf="!fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched" class="text-danger">
              Please upload a file
            </div>
            <div *ngIf="fileNames[i]" class="mt-2">
              <strong>Uploaded File:</strong> {{fileNames[i]}}
            </div>
             <!-- Display the file preview if it's an image  -->
            <div *ngIf="filePreviews[i]" class="mt-2">
              <img [src]="filePreviews[i]" alt="File preview" class="img-fluid" />
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button> 
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

<!-- Submitted Cards Section -->
<div class="mt-4">
  <h3>Submitted Cards</h3>
  <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
    <div class="card-body">
      <p><strong>Card {{ j + 1 }}</strong></p>
      <p>Name: {{ submittedCard.name }}</p>
      <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
      <p>Date: {{ submittedCard.date }}</p>
      
      <!-- Display uploaded file name -->
      <p><strong>Uploaded File:</strong> {{ submittedCard.uploadfile || 'No file uploaded' }}</p>
      
      <!-- Show file preview if available -->
      <div *ngIf="submittedCard.filePreview">
        <img [src]="submittedCard.filePreview" alt="File preview" class="img-fluid" />
      </div>

        <!-- Edit Button -->
        <button type="button" 
                class="btn btn-warning ed-bt mt-3 " 
                (click)="editSelectedCard(j)">
          Edit
        </button>
        
        <!-- Delete Button -->
        <button type="button" 
                class="btn btn-danger det-bt mt-3 "
                (click)="deleteSelectedCard(j)">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  }

  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', Validators.required],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      // alert('The main card cannot be deleted.');
      return;
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      this.fileNames[index] = file.name;

      // Create a preview URL for the uploaded file (for images)
      const reader = new FileReader();
      reader.onload = (e: any) => {
        this.filePreviews[index] = e.target.result;
      };
      reader.readAsDataURL(file); // This will generate the preview of the image
    }
  }

  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension ?? '');
  }

  submit(index: number) {
    // Manually mark all controls as touched to trigger validation
    const controls = this.cards[index].controls;
    for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
        controls[control].markAsTouched();
      }
    }
  
    // Mark each control as touched
    for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
        controls[control].markAsTouched();
      }
    }
  
    // If the form is valid, submit the card
    if (this.cards[index].valid) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
        return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });
  
      // Handle card update or addition
      if (this.editingIndex !== null) {
        this.submittedCards[this.editingIndex] = {
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || '' 
        };
        this.editingIndex = null;
        // alert('Card updated successfully!');
      } else {
        this.submittedCards.push({
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || ''
        });
        // alert('Card submitted successfully!');
      }
      // Reset the form after successful submission
      this.cards[index].reset({
        name: '',
        dropdown: [],
        date: ''
      });
      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';
  
      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
        fileInput.value = '';
      }
    }
  }
  
  updatePlaceholder(field: string, message: string) {
    let placeholder = '';
    if (field === 'name') {
      placeholder = message;
    } else if (field === 'dropdown') {
      placeholder = message;
    } else if (field === 'date') {
      placeholder = message;
    } else if (field === 'file') {
      placeholder = message;
    }
    
    const inputField = document.querySelector(`[formControlName="${field}"]`) as HTMLInputElement;
    if (inputField) {
      inputField.placeholder = placeholder;
    }
  }  

  editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index; 
    const dropdownIds = cardToEdit.dropdown.map((text: string) => {
      const matchingItem = this.dropdownList.find(item => item.item_text === text);
      return matchingItem ? matchingItem.item_id : null;
    }).filter((id: null) => id !== null);
    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: dropdownIds,
      date: cardToEdit.date
    });

    // this.selectedItems[0] = dropdownIds.map((id: number) => {
    //   const matchingItem = this.dropdownList.find(item => item.item_id === id);
    //   return matchingItem ? matchingItem.item_text : '';
    // });
  }
  
  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
    // alert('Card deleted successfully!');
  }
}

<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">
          <!-- Name Field -->
          <div class="form-group">
            <label>Name 
              <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span>
            </label>
            <input formControlName="name" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                   [placeholder]="card.get('name')?.invalid && card.get('name')?.touched ? 'Name is required' : 'Enter name'"/>
            <div *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">
              Please enter a name.
            </div>
          </div>

          <!-- Dropdown Field -->
          <div class="form-group">
            <label>Dropdown 
              <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
            </label>
            <ng-select 
              [items]="dropdownList"  
              bindLabel="item_text"  
              bindValue="item_id"
              [(ngModel)]="selectedItems[i]"
              [multiple]="true"  
              placeholder="Select options"
              (change)="onItemSelect($event, i)" 
              [clearable]="true" 
              [closeOnSelect]="true"
              [ngModelOptions]="{standalone: true}"
              [compareWith]="compareWith">  
            </ng-select>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>

          <!-- Date Field -->
          <div class="form-group">
            <label>Date 
              <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span>
            </label>
            <input type="date" formControlName="date" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"
                   [placeholder]="card.get('date')?.invalid && card.get('date')?.touched ? 'Date is required' : ''"/>
            <div *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">
              Please select a date.
            </div>
           
          </div>
          <!-- Upload File Section -->
          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile" [attr.data-index]="i"
                   [placeholder]="fileNames[i] ? 'File uploaded' : 'Please upload a file'" class="form-control" />
  
            <div *ngIf="!fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched" class="text-danger">
              Please upload a file.
            </div>

            <!-- Display File Preview if available -->
            <div *ngIf="filePreviews[i]" class="mt-2">
              <img [src]="filePreviews[i]" alt="File preview" class="img-fluid" />
              <p><strong>File Name:</strong> {{ fileNames[i] }}</p>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button> 
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Submitted Cards Section -->
<div class="mt-4">
  <h3>Submitted Cards</h3>
  <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
    <div class="card-body">
      <p><strong>Card {{ j + 1 }}</strong></p>
      <p>Name: {{ submittedCard.name }}</p>
      <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
      <p>Date: {{ submittedCard.date }}</p>

      <!-- Display uploaded file name -->
      <div *ngIf="submittedCard.uploadfile">
        <p><strong>Uploaded File:</strong> {{ submittedCard.uploadfile }}</p>
      </div>
      
      <!-- Show file preview if available -->
      <div *ngIf="submittedCard.filePreview">
        <img [src]="submittedCard.filePreview" alt="File preview" class="img-fluid" />
      </div>

      <!-- Edit Button -->
      <button type="button" 
              class="btn btn-warning ed-bt mt-3 " 
              (click)="editSelectedCard(j)">
        Edit
      </button>
      
      <!-- Delete Button -->
      <button type="button" 
              class="btn btn-danger det-bt mt-3 "
              (click)="deleteSelectedCard(j)">
        Delete
      </button>
    </div>
  </div>
</div>
</div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  }

  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', Validators.required],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      this.fileNames[index] = file.name;

      // Create a preview URL for the uploaded file (for images)
      const reader = new FileReader();
      reader.onload = (e: any) => {
        this.filePreviews[index] = e.target.result;
      };
      reader.readAsDataURL(file); // generate the preview of the image
    }
  }

  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension ?? '');
  }

  submit(index: number) {
    // Manually mark all controls as touched to trigger validation
    const controls = this.cards[index].controls;
    for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
        controls[control].markAsTouched();
      }
    }

    // If the form is valid, submit the card
    if (this.cards[index].valid) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
        return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });

      // Handle card update or addition
      if (this.editingIndex !== null) {
        this.submittedCards[this.editingIndex] = {
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || ''
        };
        this.editingIndex = null;
      } else {
        this.submittedCards.push({
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || ''
        });
      }

      // Reset the form after successful submission
      this.cards[index].reset({
        name: '',
        dropdown: [],
        date: ''
      });
      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';

      // Clear file input field
      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
        fileInput.value = '';
      }
    }
  }

  editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;
  
    
    const dropdownItems = cardToEdit.dropdown.map((itemId: number) => {
      return this.dropdownList.find(item => item.item_id === itemId);
    }).filter((item: undefined) => item !== undefined);  
  
    
    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: dropdownItems,  
      date: cardToEdit.date
    });
  
    this.fileNames[0] = cardToEdit.uploadfile || '';  
    this.filePreviews[0] = cardToEdit.filePreview || '';  
  }

  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}

<!-- user cannot enter same name in cards set that  -->
<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">
          <!-- Name Field -->
          <div class="form-group">
            <label>Name 
              <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span>
            </label>
            <input formControlName="name" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}" 
                   [placeholder]="card.get('name')?.invalid && card.get('name')?.touched ? 'Name is required' : 'Enter name'"/>
            <div *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">
              Please enter a name.
            </div>
          </div>

          <!-- Dropdown Field -->
          <div class="form-group">
            <label>Dropdown 
              <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
            </label>
            <ng-select 
              [items]="dropdownList"  
              bindLabel="item_text"  
              bindValue="item_id"
              [(ngModel)]="selectedItems[i]"
              [multiple]="true"  
              placeholder="Select options"
              (change)="onItemSelect($event, i)" 
              [clearable]="true" 
              [closeOnSelect]="true"
              [ngModelOptions]="{standalone: true}"
              [compareWith]="compareWith">  
            </ng-select>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>

          <!-- Date Field -->
          <div class="form-group">
            <label>Date 
              <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span>
            </label>
            <input type="date" formControlName="date" 
                   class="form-control" 
                   [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"
                   [placeholder]="card.get('date')?.invalid && card.get('date')?.touched ? 'Date is required' : ''"/>
            <div *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">
              Please select a date.
            </div>
           
          </div>
          <!-- Upload File Section -->
          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile" [attr.data-index]="i"
                   [placeholder]="fileNames[i] ? 'File uploaded' : 'Please upload a file'" class="form-control" />
  
            <div *ngIf="!fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched" class="text-danger">
              Please upload a file.
            </div>

            <!-- Display File Preview if available -->
            <div *ngIf="filePreviews[i]" class="mt-2">
              <img [src]="filePreviews[i]" alt="File preview" class="img-fluid" />
              <p><strong>File Name:</strong> {{ fileNames[i] }}</p>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button> 
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Submitted Cards Section -->
<div class="mt-4">
  <h3>Submitted Cards</h3>
  <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
    <div class="card-body">
      <p><strong>Card {{ j + 1 }}</strong></p>
      <p>Name: {{ submittedCard.name }}</p>
      <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
      <p>Date: {{ submittedCard.date | date:'dd/mm/yyyy'}}</p>

      <!-- Display uploaded file name -->
      <div *ngIf="submittedCard.uploadfile">
        <p><strong>Uploaded File:</strong> {{ submittedCard.uploadfile }}</p>
      </div>
      
      <!-- Show file preview if available -->
      <div *ngIf="submittedCard.filePreview">
        <img [src]="submittedCard.filePreview" alt="File preview" class="img-fluid" />
      </div>

      <!-- Edit Button -->
      <button type="button" 
              class="btn btn-warning ed-bt mt-3 " 
              (click)="editSelectedCard(j)">
        Edit
      </button>
      
      <!-- Delete Button -->
      <button type="button" 
              class="btn btn-danger det-bt mt-3 "
              (click)="deleteSelectedCard(j)">
        Delete
      </button>
    </div>
  </div>
</div>
</div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  }

  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', Validators.required],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      this.fileNames[index] = file.name;

      const reader = new FileReader();
      reader.onload = (e: any) => {
        this.filePreviews[index] = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  }

  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension ?? '');
  }

  submit(index: number) {
    // Manually mark all controls as touched to trigger validation
    const controls = this.cards[index].controls;
    for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
        controls[control].markAsTouched();
      }
    }
  
    // If the form is valid, submit the card
    if (this.cards[index].valid) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
        return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });
  
      // Handle card update or addition
      if (this.editingIndex !== null) {
        this.submittedCards[this.editingIndex] = {
          name: cardValue.name,
          dropdown: dropdownTexts, 
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || '',
          
        };
        this.editingIndex = null;
      } else {
        this.submittedCards.push({
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || ''
        });
        
      }
      this.cards[index].reset({
        name: '',
        dropdown: [],
        date: ''
      });
      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';
  
      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
        fileInput.value = '';
      }
    }
  }
  
 editSelectedCard(index: number) {
  const cardToEdit = this.submittedCards[index];
  this.editingIndex = index;

  // Set the selected items based on the dropdown values from the submitted card
  this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
    return this.dropdownList.find(item => item.item_text === itemText);
  }).filter((item: undefined) => item !== undefined);

  this.cards[0].patchValue({
    name: cardToEdit.name,
    dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
    date: cardToEdit.date
  });

  this.fileNames[0] = cardToEdit.uploadfile || '';
  this.filePreviews[0] = cardToEdit.filePreview || '';
}

  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}

<div class="form-group">
  <label>Dropdown
    <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
  </label>
  <ng-select [items]="dropdownList" bindLabel="item_text" bindValue="item_id" [(ngModel)]="selectedItems[i]"
    [multiple]="true" placeholder="Select options" (change)="onItemSelect($event, i)" [clearable]="true"
    [closeOnSelect]="true" [ngModelOptions]="{standalone: true}" [compareWith]="compareWith">
  </ng-select>
  <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
    Please select at least one option.
  </div>
</div>

submit(index: number) {
  // Manually mark all controls as touched to trigger validation
  const controls = this.cards[index].controls;
  for (const control in controls) {
    if (controls.hasOwnProperty(control)) {
      controls[control].markAsTouched();
    }
  }

  // If the form is valid, submit the card
  if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
    const cardValue = this.cards[index].value;
    const dropdownTexts = cardValue.dropdown.map((id: number) => {
      return this.dropdownList.find(item => item.item_id === id)?.item_text;
    });

    // Handle card update or addition
    if (this.editingIndex !== null) {
      this.submittedCards[this.editingIndex] = {
        name: cardValue.name,
        dropdown: dropdownTexts, 
        date: cardValue.date,
        uploadfile: this.fileNames[index] || 'No file uploaded',
        filePreview: this.filePreviews[index] || '',
      };
      this.editingIndex = null;
    } else {
      this.submittedCards.push({
        name: cardValue.name,
        dropdown: dropdownTexts,
        date: cardValue.date,
        uploadfile: this.fileNames[index] || 'No file uploaded',
        filePreview: this.filePreviews[index] || ''
      });
    }

    // Reset the form after submission
    this.cards[index].reset({
      name: '',
      dropdown: [],
      date: ''
    });
    this.selectedItems[index] = [];
    this.fileNames[index] = ''; 
    this.filePreviews[index] = '';

    const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
    if (fileInput) {
      fileInput.value = '';
    }
  }
}

 <!-- New error message for duplicate submission -->
 <div *ngIf="card.get('dropdown')?.touched" class="text-danger">
  These options have already been submitted. Please select different options.
</div>
</div>

// Check if the selected dropdown options already exist in submittedCards
const alreadySubmitted = this.submittedCards.some(card => {
  const submittedDropdowns = card.dropdown;
  return submittedDropdowns.length === dropdownTexts.length && 
         submittedDropdowns.every((text: any) => dropdownTexts.includes(text));
});

if (alreadySubmitted) {
  // alert('These options have already been submitted. Please select different options.');
  return; // Prevent submission
}

//in create card form give validation for the dropdown becasue error of already been submitted it's not showing in display for placeholder
  <!-- Dropdown Field -->
  <div class="form-group">
    <label>Dropdown
      <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
    </label>
    <ng-select [items]="dropdownList" bindLabel="item_text" bindValue="item_id" [(ngModel)]="selectedItems[i]"
      [multiple]="true" placeholder="Select options" (change)="onItemSelect($event, i)" [clearable]="true"
      [closeOnSelect]="true" [ngModelOptions]="{standalone: true}" [compareWith]="compareWith">
    </ng-select>
    <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
      Please select at least one option.
    </div>
    <div *ngIf="duplicateSubmissionError && card.get('dropdown')?.touched" class="text-danger">
      These options have already been submitted. Please select different options.
    </div>
  </div>

  import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  }

  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', [Validators.required, this.uniqueNameValidator(this.submittedCards), this.nonumber(this.submittedCards)]],
      dropdown: [[], Validators.required],this.
      date: ['', Validators.required],
    });
  }
  
  nonumber(_submittedCards: any[]): (control: AbstractControl) => ValidationErrors | null {
     // Custom validator to check if the name contains number in the submitted cards
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null; 
      }
      const hasNumber = /\d/.test(control.value);
      return hasNumber ? { hasNumber: true } : null;
    };
  }
  
  uniqueNameValidator(submittedCards: any[]): any {
    // Custom validator to check if the name already exists in the submitted cards
      return (control: AbstractControl): ValidationErrors | null => {
        if (!control.value) {
          return null;
        }
        const nameExists = submittedCards.some(card => card.name === control.value);
        return nameExists ? { nameTaken: true } : null;
      };
    }

  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      this.fileNames[index] = file.name;

      const reader = new FileReader();
      reader.onload = (e: any) => {
        this.filePreviews[index] = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  }

  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension ?? '');
  }

  duplicateSubmissionError: boolean = false; 

  submit(index: number) {
    // Manually mark all controls as touched to trigger validation
    const controls = this.cards[index].controls;
    for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
        controls[control].markAsTouched();
      }
    }
  
    // If the form is valid, submit the card
    if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
        return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });
  
      // Check if the selected dropdown options already exist in submittedCards
      const alreadySubmitted = this.submittedCards.some(card => {
        const submittedDropdowns = card.dropdown;
        return submittedDropdowns.length === dropdownTexts.length && 
               submittedDropdowns.every((text: any) => dropdownTexts.includes(text));
      });

      if (alreadySubmitted) {
        // alert('These options have already been submitted. Please select different options.');
        return; // Prevent submission
      }
      // Handle card update or addition
      if (this.editingIndex !== null) {
        this.submittedCards[this.editingIndex] = {
          name: cardValue.name,
          dropdown: dropdownTexts, 
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || '',
        };
        this.editingIndex = null;
      } else {
        this.submittedCards.push({
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || ''
        });
      }

      // Reset the form after submission
      this.cards[index].reset({
        name: '',
        dropdown: [],
        date: ''
      });

      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';
  
      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
        fileInput.value = '';
      }
    }
  }

  editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;

    // Set the selected items based on the dropdown values from the submitted card
    this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
      return this.dropdownList.find(item => item.item_text === itemText);
    }).filter((item: undefined) => item !== undefined);

    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
      date: cardToEdit.date
    });

    this.fileNames[0] = cardToEdit.uploadfile || '';
    this.filePreviews[0] = cardToEdit.filePreview || '';
  }

  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}


//if user slect anthor option the error should be remove from dropdown for selecting anthor option have word by teseting and if has not error remove error line immediatly
 <!-- Dropdown Field -->
 <div class="form-group">
  <label>Dropdown
    <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
  </label>
  <ng-select [items]="dropdownList" bindLabel="item_text" bindValue="item_id" [(ngModel)]="selectedItems[i]"
    [multiple]="true" placeholder="Select options" (change)="onItemSelect($event, i)" [clearable]="true"
    [closeOnSelect]="true" [ngModelOptions]="{standalone: true}" [compareWith]="compareWith">
  </ng-select>
  <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
    Please select at least one option.
  </div>
  <div *ngIf="duplicateSubmissionError && card.get('dropdown')?.touched" class="text-danger">
    This Option has been submitted Choose Anthor 
  </div>
</div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

//Dropdownlist Initializer
  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

//Dropdown Compare
  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  }

//Form Validators
  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', [Validators.required, this.uniqueNameValidator(this.submittedCards), this.nonumber(this.submittedCards)]],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

   // Custom validator to check if the name contains --number-- in the submitted cards
  nonumber(_submittedCards: any[]): (control: AbstractControl) => ValidationErrors | null {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null; 
      }
      const hasNumber = /\d/.test(control.value);
      return hasNumber ? { hasNumber: true } : null;
    };
  }
  
  // Custom validator to check if the --name-- already exists in the submitted cards
  uniqueNameValidator(submittedCards: any[]): any {
      return (control: AbstractControl): ValidationErrors | null => {
        if (!control.value) {
          return null;
        }
        const nameExists = submittedCards.some(card => card.name === control.value);
        return nameExists ? { nameTaken: true } : null;
      };
    }

//Main card
  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      this.fileNames[index] = file.name;

      const reader = new FileReader();
      reader.onload = (e: any) => {
        this.filePreviews[index] = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  }

  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension ?? '');
  }

  duplicateSubmissionError: boolean = false; 

  submit(index: number) {
    // Manually mark all controls as touched to trigger validation
    const controls = this.cards[index].controls;
    for (const control in controls) {
        if (controls.hasOwnProperty(control)) {
            controls[control].markAsTouched();
        }
    }

    // Check if the dropdown is empty
    if (this.cards[index].get('dropdown')?.invalid) {
        return; // Prevent submission if dropdown is invalid
    }

    // If the form is valid and the dropdown is valid, check for duplicate submission
    if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
        const cardValue = this.cards[index].value;
        const dropdownTexts = cardValue.dropdown.map((id: number) => {
            return this.dropdownList.find(item => item.item_id === id)?.item_text;
        });

        // Check if the selected dropdown options already exist in submittedCards
        const alreadySubmitted = this.submittedCards.some(card => {
            const submittedDropdowns = card.dropdown;
            return submittedDropdowns.length === dropdownTexts.length && 
                   submittedDropdowns.every((text: any) => dropdownTexts.includes(text));
        });

        if (alreadySubmitted) {
            this.duplicateSubmissionError = true; // Set the error flag
            return; // Prevent submission
        } else {
            this.duplicateSubmissionError = false; // Reset the error flag if no duplicates
        }

        // Handle card update or addition
        if (this.editingIndex !== null) {
            this.submittedCards[this.editingIndex] = {
                name: cardValue.name,
                dropdown: dropdownTexts, 
                date: cardValue.date,
                uploadfile: this.fileNames[index] || 'No file uploaded',
                filePreview: this.filePreviews[index] || '',
            };
            this.editingIndex = null;
        } else {
            this.submittedCards.push({
                name: cardValue.name,
                dropdown: dropdownTexts,
                date: cardValue.date,
                uploadfile: this.fileNames[index] || 'No file uploaded',
                filePreview: this.filePreviews[index] || ''
            });
        }

        // Reset the form after submission
        this.cards[index].reset({
            name: '',
            dropdown: [],
            date: ''
        });

        this.selectedItems[index] = [];
        this.fileNames[index] = ''; 
        this.filePreviews[index] = '';

        const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
        if (fileInput) {
            fileInput.value = '';
        }
    }
}
//Edit submitted cards
  editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;

    // Set the selected items based on the dropdown values from the submitted card
    this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
      return this.dropdownList.find(item => item.item_text === itemText);
    }).filter((item: undefined) => item !== undefined);

    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
      date: cardToEdit.date
    });

    this.fileNames[0] = cardToEdit.uploadfile || '';
    this.filePreviews[0] = cardToEdit.filePreview || '';
  }

  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}


 if file has same name it's can't be uploaded again and also for dropdown if user select multiple option if that is submiited it's not allowed also to submit again
 <div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">

          <!-- Name Field -->
          <div class="form-group">
            <label>Name
              <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span>
            </label>
            <input formControlName="name" class="form-control"
              [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}"
              [placeholder]="card.get('name')?.invalid && card.get('name')?.touched ? 'Name is required' : 'Enter name'" />
            <div *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">
              <div *ngIf="card.get('name')?.hasError('required')">Please enter a name.</div>
              <div *ngIf="card.get('name')?.hasError('nameTaken')">This name is already taken.</div>
              <div *ngIf="card.get('name')?.hasError('hasNumber')">Numbers can't be used as names.</div>
            </div>
          </div>

          <div class="form-group">
            <label>Dropdown
              <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
            </label>
            <ng-select [items]="dropdownList" bindLabel="item_text" bindValue="item_id" [(ngModel)]="selectedItems[i]"
              [multiple]="true" placeholder="Select options" (change)="onItemSelect($event, i)" [clearable]="true"
              [closeOnSelect]="true" [ngModelOptions]="{standalone: true}" [compareWith]="compareWith">
            </ng-select>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
            <div *ngIf="duplicateSubmissionError && card.get('dropdown')?.touched" class="text-danger">
              This Option has been submitted. Choose another.
            </div>
          </div>

          <!-- Date Field -->
          <div class="form-group">
            <label>Date
              <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span>
            </label>
            <input type="date" formControlName="date" class="form-control"
              [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"
              [placeholder]="card.get('date')?.invalid && card.get('date')?.touched ? 'Date is required' : ''" />
            <div *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">
              Please select a date.
            </div>
          </div>

          <!-- Upload File Section -->
          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile"
              [attr.data-index]="i" [placeholder]="fileNames[i] ? 'File uploaded' : 'Please upload a file'"
              class="form-control" />
            <div
              *ngIf="!fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched"
              class="text-danger">
              Please upload a file.
            </div>

            <!-- Display File Preview if available -->
            <div *ngIf="filePreviews[i]" class="mt-2">
              <img [src]="filePreviews[i]" alt="File preview" class="img-fluid" />
              <p><strong>File Name:</strong> {{ fileNames[i] }}</p>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button>
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Submitted Cards Section -->
  <div class="mt-4">
    <h3>Submitted Cards</h3>
    <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
      <div class="card-body">
        <p><strong>Card {{ j + 1 }}</strong></p>
        <p>Name: {{ submittedCard.name }}</p>
        <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
        <p>Date: {{ submittedCard.date | date:'dd/MM/yyyy'}}</p>

        <!-- Display uploaded file name -->
        <div *ngIf="submittedCard.uploadfile">
          <p><strong>Uploaded File:</strong> {{ submittedCard.uploadfile }}</p>
        </div>

        <!-- Show file preview if available -->
        <div *ngIf="submittedCard.filePreview">
          <img [src]="submittedCard.filePreview" alt="File preview" class="img-fluid" />
        </div>

        <!-- Edit Button -->
        <button type="button" class="btn btn-warning ed-bt mt-3 " (click)="editSelectedCard(j)">
          Edit
        </button>

        <!-- Delete Button -->
        <button type="button" class="btn btn-danger det-bt mt-3 " (click)="deleteSelectedCard(j)">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

//4:56 working
//multiple value in dropdown check
import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

//Dropdownlist Initializer
  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

//Dropdown Compare
  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  // onItemSelect(item: any, index: number) {
  //   this.selectedItems[index] = item;
  //   this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  // }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    const selectedItemIds = this.selectedItems[index].map((i: { item_id: any; }) => i.item_id);
    this.cards[index].get('dropdown')?.setValue(selectedItemIds);
    // Reset the duplicate submission error if the user selects a new option
    this.duplicateSubmissionError = false;
    // clear the touched state if needed
    this.cards[index].get('dropdown')?.markAsUntouched();
}

//Form Validators
  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', [Validators.required, this.uniqueNameValidator(this.submittedCards), this.nonumber(this.submittedCards)]],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

   // Custom validator to check if the name contains --number-- in the submitted cards
  nonumber(_submittedCards: any[]): (control: AbstractControl) => ValidationErrors | null {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null; 
      }
      const hasNumber = /\d/.test(control.value);
      return hasNumber ? { hasNumber: true } : null;
    };
  }
  
  // Custom validator to check if the --name-- already exists in the submitted cards
  uniqueNameValidator(submittedCards: any[]): any {
      return (control: AbstractControl): ValidationErrors | null => {
        if (!control.value) {
          return null;
        }
        const nameExists = submittedCards.some(card => card.name === control.value);
        return nameExists ? { nameTaken: true } : null;
      };
    }

//Main card
  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      this.fileNames[index] = file.name;

      const reader = new FileReader();
      reader.onload = (e: any) => {
        this.filePreviews[index] = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  }

  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension ?? '');
  }

  duplicateSubmissionError: boolean = false; 

  submit(index: number) {
    // Manually mark all controls as touched to trigger validation
    const controls = this.cards[index].controls;
    for (const control in controls) {
        if (controls.hasOwnProperty(control)) {
            controls[control].markAsTouched();
        }
    }

    // Check if the dropdown is empty
    if (this.cards[index].get('dropdown')?.invalid) {
        return; // Prevent submission if dropdown is invalid
    }

    // If the form is valid and the dropdown is valid, check for duplicate submission
    if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
        const cardValue = this.cards[index].value;
        const dropdownTexts = cardValue.dropdown.map((id: number) => {
            return this.dropdownList.find(item => item.item_id === id)?.item_text;
        });

        // Check if the selected dropdown options already exist in submittedCards
        const alreadySubmitted = this.submittedCards.some(card => {
            const submittedDropdowns = card.dropdown;
            return submittedDropdowns.length === dropdownTexts.length && 
                   submittedDropdowns.every((text: any) => dropdownTexts.includes(text));
        });

        if (alreadySubmitted) {
            this.duplicateSubmissionError = true; // Set the error flag
            return; // Prevent submission
        } else {
            this.duplicateSubmissionError = false; // Reset the error flag if no duplicates
        }

        // Handle card update or addition
        if (this.editingIndex !== null) {
            this.submittedCards[this.editingIndex] = {
                name: cardValue.name,
                dropdown: dropdownTexts, 
                date: cardValue.date,
                uploadfile: this.fileNames[index] || 'No file uploaded',
                filePreview: this.filePreviews[index] || '',
            };
            this.editingIndex = null;
        } else {
            this.submittedCards.push({
                name: cardValue.name,
                dropdown: dropdownTexts,
                date: cardValue.date,
                uploadfile: this.fileNames[index] || 'No file uploaded',
                filePreview: this.filePreviews[index] || ''
            });
        }

        // Reset the form after submission
        this.cards[index].reset({
            name: '',
            dropdown: [],
            date: ''
        });

        this.selectedItems[index] = [];
        this.fileNames[index] = ''; 
        this.filePreviews[index] = '';

        const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
        if (fileInput) {
            fileInput.value = '';
        }
    }
}
//Edit submitted cards
  editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;

    // Set the selected items based on the dropdown values from the submitted card
    this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
      return this.dropdownList.find(item => item.item_text === itemText);
    }).filter((item: undefined) => item !== undefined);

    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
      date: cardToEdit.date
    });

    this.fileNames[0] = cardToEdit.uploadfile || '';
    this.filePreviews[0] = cardToEdit.filePreview || '';
  }

  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}


import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

//Dropdownlist Initializer
  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

//Dropdown Compare 
  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  // onItemSelect(item: any, index: number) {
  //   this.selectedItems[index] = item;
  //   this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  // }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    const selectedItemIds = this.selectedItems[index].map((i: { item_id: any; }) => i.item_id);
    this.cards[index].get('dropdown')?.setValue(selectedItemIds);
    // Reset the duplicate submission error if the user selects a new option
    this.duplicateSubmissionError = false;
    // clear the touched state if needed
    this.cards[index].get('dropdown')?.markAsUntouched();
}

//Form Validators
  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', [Validators.required, this.uniqueNameValidator(this.submittedCards), this.nonumber(this.submittedCards)]],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

   // Custom validator to check if the name contains --number-- in the submitted cards
  nonumber(_submittedCards: any[]): (control: AbstractControl) => ValidationErrors | null {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null; 
      }
      const hasNumber = /\d/.test(control.value);
      return hasNumber ? { hasNumber: true } : null;
    };
  }
  
  // Custom validator to check if the --name-- already exists
  uniqueNameValidator(submittedCards: any[]): any {
      return (control: AbstractControl): ValidationErrors | null => {
        if (!control.value) {
          return null;
        }
        const nameExists = submittedCards.some(card => card.name === control.value);
        return nameExists ? { nameTaken: true } : null;
      };
    }

//Main card
  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  // handleFileInput(event: any, index: number) {
  //   const file = event.target.files[0];
  //   if (file) {
  //     this.fileNames[index] = file.name;

  //     const reader = new FileReader();
  //     reader.onload = (e: any) => {
  //       this.filePreviews[index] = e.target.result;
  //     };
  //     reader.readAsDataURL(file);
  //   }
  // }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
        // Check if the file name already exists in submitted cards
        const fileNameExists = this.submittedCards.some(card => card.uploadfile === file.name);
        if (fileNameExists) {
            alert('This file has already been uploaded. Please choose a different file.');
            // Clear the input
            event.target.value = '';
            return;
        }
        this.fileNames[index] = file.name;
        const reader = new FileReader();
        reader.onload = (e: any) => {
            this.filePreviews[index] = e.target.result;
        };
        reader.readAsDataURL(file);
    }
}

  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension ?? '');
  }

  duplicateSubmissionError: boolean = false; 

//   submit(index: number) {
//     // Manually mark all controls as touched to trigger validation
//     const controls = this.cards[index].controls;
//     for (const control in controls) {
//         if (controls.hasOwnProperty(control)) {
//             controls[control].markAsTouched();
//         }
//     }

//     // Check if the dropdown is empty
//     if (this.cards[index].get('dropdown')?.invalid) {
//         return; // Prevent submission if dropdown is invalid
//     }

//     // If the form is valid and the dropdown is valid, check for duplicate submission
//     if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
//         const cardValue = this.cards[index].value;
//         const dropdownTexts = cardValue.dropdown.map((id: number) => {
//             return this.dropdownList.find(item => item.item_id === id)?.item_text;
//         });

//         // Check if the selected dropdown options already exist in submittedCards
//         const alreadySubmitted = this.submittedCards.some(card => {
//             const submittedDropdowns = card.dropdown;
//             return submittedDropdowns.length === dropdownTexts.length && 
//                    submittedDropdowns.every((text: any) => dropdownTexts.includes(text));
//         });

//         if (alreadySubmitted) {
//             this.duplicateSubmissionError = true; // Set the error flag
//             return; // Prevent submission
//         } else {
//             this.duplicateSubmissionError = false; // Reset the error flag if no duplicates
//         }

//         // Handle card update or addition
//         if (this.editingIndex !== null) {
//             this.submittedCards[this.editingIndex] = {
//                 name: cardValue.name,
//                 dropdown: dropdownTexts, 
//                 date: cardValue.date,
//                 uploadfile: this.fileNames[index] || 'No file uploaded',
//                 filePreview: this.filePreviews[index] || '',
//             };
//             this.editingIndex = null;
//         } else {
//             this.submittedCards.push({
//                 name: cardValue.name,
//                 dropdown: dropdownTexts,
//                 date: cardValue.date,
//                 uploadfile: this.fileNames[index] || 'No file uploaded',
//                 filePreview: this.filePreviews[index] || ''
//             });
//         }

//         // Reset the form after submission
//         this.cards[index].reset({
//             name: '',
//             dropdown: [],
//             date: ''
//         });

//         this.selectedItems[index] = [];
//         this.fileNames[index] = ''; 
//         this.filePreviews[index] = '';

//         const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
//         if (fileInput) {
//             fileInput.value = '';
//         }
//     }
// }
//Edit submitted cards

//

submit(index: number) {
  // Manually mark all controls as touched to trigger validation
  const controls = this.cards[index].controls;
  for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
          controls[control].markAsTouched();
      }
  }

  // Check if the dropdown is empty
  if (this.cards[index].get('dropdown')?.invalid) {
      return; // Prevent submission if dropdown is invalid
  }

  // If the form is valid and the dropdown is valid, check for duplicate submission
  if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
          return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });

      // Check for duplicates in selected dropdown values
      const hasDuplicates = new Set(dropdownTexts).size !== dropdownTexts.length;
      if (hasDuplicates) {
          alert('Duplicate dropdown selections are not allowed. Please select unique options.');
          return; // Prevent submission
      }

      // Check if the selected dropdown options already exist in submittedCards
      const alreadySubmitted = this.submittedCards.some(card => {
          const submittedDropdowns = card.dropdown;
          return submittedDropdowns.length === dropdownTexts.length && 
                 submittedDropdowns.every((text: any) => dropdownTexts.includes(text));
      });

      if (alreadySubmitted) {
          this.duplicateSubmissionError = true; // Set the error flag
          return; // Prevent submission
      } else {
          this.duplicateSubmissionError = false; // Reset the error flag if no duplicates
      }

      // Handle card update or addition
      if (this.editingIndex !== null) {
          this.submittedCards[this.editingIndex] = {
              name: cardValue.name,
              dropdown: dropdownTexts,
              date: cardValue.date,
              uploadfile: this.fileNames[index] || 'No file uploaded',
              filePreview: this.filePreviews[index] || '',
          };
          this.editingIndex = null;
      } else {
          this.submittedCards.push({
              name: cardValue.name,
              dropdown: dropdownTexts,
              date: cardValue.date,
              uploadfile: this.fileNames[index] || 'No file uploaded',
              filePreview: this.filePreviews[index] || ''
          });
      }

      // Reset the form after submission
      this.cards[index].reset({
          name: '',
          dropdown: [],
          date: ''
      });

      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';

      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
          fileInput.value = '';
      }
  }
}

editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;

    // Set the selected items based on the dropdown values from the submitted card
    this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
      return this.dropdownList.find(item => item.item_text === itemText);
    }).filter((item: undefined) => item !== undefined);

    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
      date: cardToEdit.date
    });

    this.fileNames[0] = cardToEdit.uploadfile || '';
    this.filePreviews[0] = cardToEdit.filePreview || '';
  }

  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}


//5:45
in edit for submitted card allow with same value to upload for dropdown option value but not for submit card 
import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

//Dropdownlist Initializer
  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

//Dropdown Compare 
  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  // onItemSelect(item: any, index: number) {
  //   this.selectedItems[index] = item;
  //   this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  // }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    const selectedItemIds = this.selectedItems[index].map((i: { item_id: any; }) => i.item_id);
    this.cards[index].get('dropdown')?.setValue(selectedItemIds);
    // Reset the duplicate submission error if the user selects a new option
    this.duplicateSubmissionError = false;
    // clear the touched state if needed
    this.cards[index].get('dropdown')?.markAsUntouched();
}

//Form Validators
  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', [Validators.required, this.uniqueNameValidator(this.submittedCards), this.nonumber(this.submittedCards)]],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

   // Custom validator to check if the name contains --number-- in the submitted cards
  nonumber(_submittedCards: any[]): (control: AbstractControl) => ValidationErrors | null {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null; 
      }
      const hasNumber = /\d/.test(control.value);
      return hasNumber ? { hasNumber: true } : null;
    };
  }
  
  // Custom validator to check if the --name-- already exists
  uniqueNameValidator(submittedCards: any[]): any {
      return (control: AbstractControl): ValidationErrors | null => {
        if (!control.value) {
          return null;
        }
        const nameExists = submittedCards.some(card => card.name === control.value);
        return nameExists ? { nameTaken: true } : null;
      };
    }

//Main card
  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
        // Check if the file name already exists in submitted cards
        const fileNameExists = this.submittedCards.some(card => card.uploadfile === file.name);
        if (fileNameExists) {
            alert('This file has already been uploaded. Please choose a different file.');
            // Clear the input
            event.target.value = '';
            return;
        }
        this.fileNames[index] = file.name;
        const reader = new FileReader();
        reader.onload = (e: any) => {
            this.filePreviews[index] = e.target.result;
        };
        reader.readAsDataURL(file);
    }
}

  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif',].includes(fileExtension ?? '');
  }

  duplicateSubmissionError: boolean = false; 

submit(index: number) {
  // Manually mark all controls as touched to trigger validation
  const controls = this.cards[index].controls;
  for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
          controls[control].markAsTouched();
      }
  }

  // Check if the dropdown is empty
  if (this.cards[index].get('dropdown')?.invalid) {
      return; // Prevent submission if dropdown is invalid
  }

  // If the form is valid and the dropdown is valid, check for duplicate submission
  if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
          return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });

      // Check for duplicates in selected dropdown values
      const hasDuplicates = new Set(dropdownTexts).size !== dropdownTexts.length;
      if (hasDuplicates) {
          alert('Duplicate dropdown selections are not allowed. Please select unique options.');
          return; // Prevent submission
      }

      // Check if the selected dropdown options already exist in submittedCards
      const alreadySubmitted = this.submittedCards.some(card => {
          const submittedDropdowns = card.dropdown;
          return submittedDropdowns.length === dropdownTexts.length && 
                 submittedDropdowns.every((text: any) => dropdownTexts.includes(text));
      });

      // Check across all cards if any dropdown value is repeated
      const allDropdowns = this.submittedCards.flatMap(card => card.dropdown);
      const hasCommonValues = dropdownTexts.some((value: any) => allDropdowns.includes(value));

      if (hasCommonValues) {
          this.duplicateSubmissionError = true; // Set the error flag
          // alert('Duplicate values detected across cards. Please choose unique values.');
          return; // Prevent submission
      } else {
          this.duplicateSubmissionError = false; // Reset the error flag if no duplicates
      }

      // Handle card update or addition
      if (this.editingIndex !== null) {
          this.submittedCards[this.editingIndex] = {
              name: cardValue.name,
              dropdown: dropdownTexts,
              date: cardValue.date,
              uploadfile: this.fileNames[index] || 'No file uploaded',
              filePreview: this.filePreviews[index] || '',
          };
          this.editingIndex = null;
      } else {
          this.submittedCards.push({
              name: cardValue.name,
              dropdown: dropdownTexts,
              date: cardValue.date,
              uploadfile: this.fileNames[index] || 'No file uploaded',
              filePreview: this.filePreviews[index] || ''
          });
      }

      // Reset the form after submission
      this.cards[index].reset({
          name: '',
          dropdown: [],
          date: ''
      });

      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';

      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
          fileInput.value = '';
      }
  }
}


editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;

    // Set the selected items based on the dropdown values from the submitted card
    this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
      return this.dropdownList.find(item => item.item_text === itemText);
    }).filter((item: undefined) => item !== undefined);

    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
      date: cardToEdit.date
    });

    this.fileNames[0] = cardToEdit.uploadfile || '';
    this.filePreviews[0] = cardToEdit.filePreview || '';
  }

  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}


in dropdown option if have multiple option if it's already been submitted it's should be disabled not even able to select it

<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">

          <!-- Name Field -->
          <div class="form-group">
            <label>Name
              <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span>
            </label>
            <input formControlName="name" class="form-control"
              [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}"
              [placeholder]="card.get('name')?.invalid && card.get('name')?.touched ? 'Name is required' : 'Enter name'" />
            <div *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">
              <div *ngIf="card.get('name')?.hasError('required')">Please enter a name.</div>
              <div *ngIf="card.get('name')?.hasError('nameTaken')">This name is already taken.</div>
              <div *ngIf="card.get('name')?.hasError('hasNumber')">Numbers can't be used as names.</div>
            </div>
          </div>

          <div class="form-group">
            <label>Dropdown
              <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
            </label>
            <ng-select [items]="dropdownList" bindLabel="item_text" bindValue="item_id" [(ngModel)]="selectedItems[i]"
              [multiple]="true" placeholder="Select options" (change)="onItemSelect($event, i)" [clearable]="true"
              [closeOnSelect]="true" [ngModelOptions]="{standalone: true}" [compareWith]="compareWith">
            </ng-select>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
            <div *ngIf="duplicateSubmissionError && card.get('dropdown')?.touched" class="text-danger">
              Option has been submitted. Choose another.
            </div>
          </div>

          <!-- Date Field -->
          <div class="form-group">
            <label>Date
              <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span>
            </label>
            <input type="date" formControlName="date" class="form-control"
              [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"
              [placeholder]="card.get('date')?.invalid && card.get('date')?.touched ? 'Date is required' : ''" />
            <div *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">
              Please select a date.
            </div>
          </div>

          <!-- Upload File Section -->
          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile"
              [attr.data-index]="i" [placeholder]="fileNames[i] ? 'File uploaded' : 'Please upload a file'"
              class="form-control" />
            <div
              *ngIf="!fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched"
              class="text-danger">
              Please upload a file.
            </div>

            <!-- Display File Preview if available -->
            <div *ngIf="filePreviews[i]" class="mt-2">
              <img [src]="filePreviews[i]" alt="File preview" class="img-fluid" />
              <p><strong>File Name:</strong> {{ fileNames[i] }}</p>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button>
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Submitted Cards Section -->
  <div class="mt-4">
    <h3>Submitted Cards</h3>
    <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
      <div class="card-body">
        <p><strong>Card {{ j + 1 }}</strong></p>
        <p>Name: {{ submittedCard.name }}</p>
        <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
        <p>Date: {{ submittedCard.date | date:'dd/MM/yyyy'}}</p>

        <!-- Display uploaded file name -->
        <div *ngIf="submittedCard.uploadfile">
          <p><strong>Uploaded File:</strong> {{ submittedCard.uploadfile }}</p>
        </div>

        <!-- Show file preview if available -->
        <div *ngIf="submittedCard.filePreview">
          <img [src]="submittedCard.filePreview" alt="File preview" class="img-fluid" />
        </div>

        <!-- Edit Button -->
        <button type="button" class="btn btn-warning ed-bt mt-3 " (click)="editSelectedCard(j)">
          Edit
        </button>

        <!-- Delete Button -->
        <button type="button" class="btn btn-danger det-bt mt-3 " (click)="deleteSelectedCard(j)">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

//Dropdownlist Initializer 
  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

//Dropdown Compare 
  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  // onItemSelect(item: any, index: number) {
  //   this.selectedItems[index] = item;
  //   this.cards[index].get('dropdown')?.setValue(this.selectedItems[index].map((i: { item_id: any; }) => i.item_id));
  // }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    const selectedItemIds = this.selectedItems[index].map((i: { item_id: any; }) => i.item_id);
    this.cards[index].get('dropdown')?.setValue(selectedItemIds);
    // Reset the duplicate submission error if the user selects a new option
    this.duplicateSubmissionError = false;
    // clear the touched state if needed
    this.cards[index].get('dropdown')?.markAsUntouched();
}

//Form Validators 
  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', [Validators.required, this.uniqueNameValidator(this.submittedCards), this.nonumber(this.submittedCards)]],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

   // Custom validator to check if the name contains --number-- in the submitted cards
  nonumber(_submittedCards: any[]): (control: AbstractControl) => ValidationErrors | null {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null; 
      }
      const hasNumber = /\d/.test(control.value);
      return hasNumber ? { hasNumber: true } : null;
    };
  }
  
  // Custom validator to check if the --name-- already exists
  uniqueNameValidator(submittedCards: any[]): any {
      return (control: AbstractControl): ValidationErrors | null => {
        if (!control.value) {
          return null;
        }
        const nameExists = submittedCards.some(card => card.name === control.value);
        return nameExists ? { nameTaken: true } : null;
      };
    }

//Main card
  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
        // Check if the file name already exists in submitted cards
        const fileNameExists = this.submittedCards.some(card => card.uploadfile === file.name);
        if (fileNameExists) {
            alert('This file has already been uploaded. Please choose a different file.');
            // Clear the input
            event.target.value = '';
            return;
        }
        this.fileNames[index] = file.name;
        const reader = new FileReader();
        reader.onload = (e: any) => {
            this.filePreviews[index] = e.target.result;
        };
        reader.readAsDataURL(file);
    }
}

  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif',].includes(fileExtension ?? '');
  }

  duplicateSubmissionError: boolean = false; 

submit(index: number) {
  // Manually mark all controls as touched to trigger validation
  const controls = this.cards[index].controls;
  for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
          controls[control].markAsTouched();
      }
  }

  // Check if the dropdown is empty
  if (this.cards[index].get('dropdown')?.invalid) {
      return; // Prevent submission if dropdown is invalid
  }

  // If the form is valid and the dropdown is valid, check for duplicate submission
  if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
          return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });

      // Check for duplicates in selected dropdown values
      const hasDuplicates = new Set(dropdownTexts).size !== dropdownTexts.length;
      if (hasDuplicates) {
          alert('Duplicate dropdown selections are not allowed. Please select unique options.');
          return; // Prevent submission
      }

      // Check if the selected dropdown options already exist in submittedCards
      const alreadySubmitted = this.submittedCards.some(card => {
          const submittedDropdowns = card.dropdown;
          return submittedDropdowns.length === dropdownTexts.length && 
                 submittedDropdowns.every((text: any) => dropdownTexts.includes(text));
      });

      // Check across all cards if any dropdown value is repeated
      const allDropdowns = this.submittedCards.flatMap(card => card.dropdown);
      const hasCommonValues = dropdownTexts.some((value: any) => allDropdowns.includes(value));

      if (hasCommonValues) {
          this.duplicateSubmissionError = true; // Set the error flag
          // alert('Duplicate values detected across cards. Please choose unique values.');
          return; // Prevent submission
      } else {
          this.duplicateSubmissionError = false; // Reset the error flag if no duplicates
      }

      // Handle card update or addition
      if (this.editingIndex !== null) {
          this.submittedCards[this.editingIndex] = {
              name: cardValue.name,
              dropdown: dropdownTexts,
              date: cardValue.date,
              uploadfile: this.fileNames[index] || 'No file uploaded',
              filePreview: this.filePreviews[index] || '',
          };
          this.editingIndex = null;
      } else {
          this.submittedCards.push({
              name: cardValue.name,
              dropdown: dropdownTexts,
              date: cardValue.date,
              uploadfile: this.fileNames[index] || 'No file uploaded',
              filePreview: this.filePreviews[index] || ''
          });
      }

      // Reset the form after submission
      this.cards[index].reset({
          name: '',
          dropdown: [],
          date: ''
      });

      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';

      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
          fileInput.value = '';
      }
  }
}


editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;

    // Set the selected items based on the dropdown values from the submitted card
    this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
      return this.dropdownList.find(item => item.item_text === itemText);
    }).filter((item: undefined) => item !== undefined);

    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
      date: cardToEdit.date
    });

    this.fileNames[0] = cardToEdit.uploadfile || '';
    this.filePreviews[0] = cardToEdit.filePreview || '';
  }

  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}



6:17

isOptionDisabled(option: DropdownItem): This method disables options already submitted based on their item_text.
Template (ng-select): Added [disabled]="isOptionDisabled(option)" to disable the options dynamically.
Submission Logic: Ensured that the options already selected in submittedCards are checked and disabled for future submissions.

// Check if an option is already in any of the submitted cards
isOptionDisabled(option: DropdownItem): boolean {
  // Check if this option is in the already submitted cards
  return this.submittedCards.some(card => {
    return card.dropdown.includes(option.item_text);
  });
}

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

  // Method to disable dropdown options that are already selected in submitted cards
  isOptionDisabled(option: DropdownItem): boolean {
    return this.submittedCards.some(card => card.dropdown.includes(option.item_text));
  }

  // other methods ...

  submit(index: number) {
    const controls = this.cards[index].controls;
    for (const control in controls) {
        if (controls.hasOwnProperty(control)) {
            controls[control].markAsTouched();
        }
    }

    if (this.cards[index].get('dropdown')?.invalid) {
        return;
    }

    if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
        const cardValue = this.cards[index].value;
        const dropdownTexts = cardValue.dropdown.map((id: number) => {
            return this.dropdownList.find(item => item.item_id === id)?.item_text;
        });

        const hasDuplicates = new Set(dropdownTexts).size !== dropdownTexts.length;
        if (hasDuplicates) {
            alert('Duplicate dropdown selections are not allowed.');
            return;
        }

        const alreadySubmitted = this.submittedCards.some(card => {
            const submittedDropdowns = card.dropdown;
            return submittedDropdowns.length === dropdownTexts.length && 
                   submittedDropdowns.every((text: any) => dropdownTexts.includes(text));
        });

        const allDropdowns = this.submittedCards.flatMap(card => card.dropdown);
        const hasCommonValues = dropdownTexts.some((value: any) => allDropdowns.includes(value));

        if (hasCommonValues) {
            alert('Some options have already been submitted.');
            return;
        } else {
            this.duplicateSubmissionError = false;
        }

        if (this.editingIndex !== null) {
            this.submittedCards[this.editingIndex] = {
                name: cardValue.name,
                dropdown: dropdownTexts,
                date: cardValue.date,
                uploadfile: this.fileNames[index] || 'No file uploaded',
                filePreview: this.filePreviews[index] || '',
            };
            this.editingIndex = null;

        } else {
            this.submittedCards.push({
                name: cardValue.name,
                dropdown: dropdownTexts,
                date: cardValue.date,
                uploadfile: this.fileNames[index] || 'No file uploaded',
                filePreview: this.filePreviews[index] || ''
            });
        }

        this.cards[index].reset({
            name: '',
            dropdown: [],
            date: ''
        });

        this.selectedItems[index] = [];
        this.fileNames[index] = ''; 
        this.filePreviews[index] = '';

        const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
        if (fileInput) {
            fileInput.value = '';
        }
    }
  }
}

if have duplicate value disable the dropdown option to select it instead 
<div *ngIf="duplicateSubmissionError && card.get('dropdown')?.touched" class="text-danger">
  Option has been submitted. Choose another.
</div>

// Check across all cards if any dropdown value is repeated
const allDropdowns = this.submittedCards.flatMap(card => card.dropdown);
const hasCommonValues = dropdownTexts.some((value: any) => allDropdowns.includes(value));

if (hasCommonValues) {
    this.duplicateSubmissionError = true; // Set the error flag
    // alert('Duplicate values detected across cards. Please choose unique values.');
    return; // Prevent submission
}
else {
    this.duplicateSubmissionError = false; // Reset the error flag if no duplicates
}

<div class="form-group">
  <label>Dropdown
    <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
  </label>
  <ng-select [items]="dropdownList" bindLabel="item_text" bindValue="item_id" [(ngModel)]="selectedItems[i]"
    [multiple]="true" placeholder="Select options" (change)="onItemSelect($event, i)" [clearable]="true"
    [closeOnSelect]="true" [ngModelOptions]="{standalone: true}" [compareWith]="compareWith">
  </ng-select>
  <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
    Please select at least one option.
  </div>
  <div *ngIf="duplicateSubmissionError && card.get('dropdown')?.touched" class="text-danger">
    Option has been submitted. Choose another.
  </div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

//Dropdownlist Initializer 
  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

//Dropdown Compare 
  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }
  isOptionDisabled(option: DropdownItem): boolean {
    return this.submittedCards.some(card => card.dropdown.includes(option.item_text));
  }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    const selectedItemIds = this.selectedItems[index].map((i: { item_id: any; }) => i.item_id);
    this.cards[index].get('dropdown')?.setValue(selectedItemIds);
    // Reset the duplicate submission error if the user selects a new option
    // this.duplicateSubmissionError = false;
    // clear the touched state if needed
    this.cards[index].get('dropdown')?.markAsUntouched();
}

//Form Validators 
  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', [Validators.required, this.uniqueNameValidator(this.submittedCards), this.nonumber(this.submittedCards)]],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

   // Custom validator to check if the name contains --number-- in the submitted cards
  nonumber(_submittedCards: any[]): (control: AbstractControl) => ValidationErrors | null {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null; 
      }
      const hasNumber = /\d/.test(control.value);
      return hasNumber ? { hasNumber: true } : null;
    };
  }
  
  // Custom validator to check if the --name-- already exists
  uniqueNameValidator(submittedCards: any[]): any {
      return (control: AbstractControl): ValidationErrors | null => {
        if (!control.value) {
          return null;
        }
        const nameExists = submittedCards.some(card => card.name === control.value);
        return nameExists ? { nameTaken: true } : null;
      };
    }

//Main card
  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
        // Check if the file name already exists in submitted cards
        const fileNameExists = this.submittedCards.some(card => card.uploadfile === file.name);
        if (fileNameExists) {
            alert('This file has already been uploaded. Please choose a different file.');
            // Clear the input
            event.target.value = '';
            return;
        }
        this.fileNames[index] = file.name;
        const reader = new FileReader();
        reader.onload = (e: any) => {
            this.filePreviews[index] = e.target.result;
        };
        reader.readAsDataURL(file);
    }
}

  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif',].includes(fileExtension ?? '');
  }

  duplicateSubmissionError: boolean = false; 

submit(index: number) {
  // Manually mark all controls as touched to trigger validation
  const controls = this.cards[index].controls;
  for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
          controls[control].markAsTouched();
      }
  }

  // Check if the dropdown is empty
  if (this.cards[index].get('dropdown')?.invalid) {
      return; // Prevent submission if dropdown is invalid
  }

  // If the form is valid and the dropdown is valid, check for duplicate submission
  if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
          return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });
      
      // Check for duplicates in selected dropdown values
      const hasDuplicates = new Set(dropdownTexts).size !== dropdownTexts.length;
      if (hasDuplicates) {
          alert('Duplicate dropdown selections are not allowed. Please select unique options.');
          return; // Prevent submission
      }
      // Check across all cards if any dropdown value is repeated
      const allDropdowns = this.submittedCards.flatMap(card => card.dropdown);
      const hasCommonValues = dropdownTexts.some((value: any) => allDropdowns.includes(value));

      if (hasCommonValues) {
          this.duplicateSubmissionError = true; // Set the error flag
          // alert('Duplicate values detected across cards. Please choose unique values.');
          return; // Prevent submission
      } 
      else {
          this.duplicateSubmissionError = false; // Reset the error flag if no duplicates
      }
      // Handle card update or addition
      if (this.editingIndex !== null) {
          this.submittedCards[this.editingIndex] = {
              name: cardValue.name,
              dropdown: dropdownTexts,
              date: cardValue.date,
              uploadfile: this.fileNames[index] || 'No file uploaded',
              filePreview: this.filePreviews[index] || '',
          };
          this.editingIndex = null;
      } else {
          this.submittedCards.push({
              name: cardValue.name,
              dropdown: dropdownTexts,
              date: cardValue.date,
              uploadfile: this.fileNames[index] || 'No file uploaded',
              filePreview: this.filePreviews[index] || ''
          });
      }

      // Reset the form after submission
      this.cards[index].reset({
          name: '',
          dropdown: [],
          date: ''
      });

      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';

      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
          fileInput.value = '';
      }
  }
}

editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;

    // Set the selected items based on the dropdown values from the submitted card
    this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
      return this.dropdownList.find(item => item.item_text === itemText);
    }).filter((item: undefined) => item !== undefined);

    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
      date: cardToEdit.date
    });

    this.fileNames[0] = cardToEdit.uploadfile || '';
    this.filePreviews[0] = cardToEdit.filePreview || '';
  }

  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}
update here for full code with those changes
import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

//Dropdownlist Initializer 
  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

//Dropdown Compare 
  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }
  isOptionDisabled(option: DropdownItem): boolean {
    return this.submittedCards.some(card => card.dropdown.includes(option.item_text));
  }

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    const selectedItemIds = this.selectedItems[index].map((i: { item_id: any; }) => i.item_id);
    this.cards[index].get('dropdown')?.setValue(selectedItemIds);
    // Reset the duplicate submission error if the user selects a new option
    // this.duplicateSubmissionError = false;
    // clear the touched state if needed
    this.cards[index].get('dropdown')?.markAsUntouched();
}

//Form Validators 
  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', [Validators.required, this.uniqueNameValidator(this.submittedCards), this.nonumber(this.submittedCards)]],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

   // Custom validator to check if the name contains --number-- in the submitted cards
  nonumber(_submittedCards: any[]): (control: AbstractControl) => ValidationErrors | null {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null; 
      }
      const hasNumber = /\d/.test(control.value);
      return hasNumber ? { hasNumber: true } : null;
    };
  }
  
  // Custom validator to check if the --name-- already exists
  uniqueNameValidator(submittedCards: any[]): any {
      return (control: AbstractControl): ValidationErrors | null => {
        if (!control.value) {
          return null;
        }
        const nameExists = submittedCards.some(card => card.name === control.value);
        return nameExists ? { nameTaken: true } : null;
      };
    }

//Main card
  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
        // Check if the file name already exists in submitted cards
        const fileNameExists = this.submittedCards.some(card => card.uploadfile === file.name);
        if (fileNameExists) {
            alert('This file has already been uploaded. Please choose a different file.');
            // Clear the input
            event.target.value = '';
            return;
        }
        this.fileNames[index] = file.name;
        const reader = new FileReader();
        reader.onload = (e: any) => {
            this.filePreviews[index] = e.target.result;
        };
        reader.readAsDataURL(file);
    }
}

  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif',].includes(fileExtension ?? '');
  }

  duplicateSubmissionError: boolean = false; 

submit(index: number) {
  // Manually mark all controls as touched to trigger validation
  const controls = this.cards[index].controls;
  for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
          controls[control].markAsTouched();
      }
  }

  // Check if the dropdown is empty
  if (this.cards[index].get('dropdown')?.invalid) {
      return; // Prevent submission if dropdown is invalid
  }

  // If the form is valid and the dropdown is valid, check for duplicate submission
  if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
          return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });
      
      // Check for duplicates in selected dropdown values
      const hasDuplicates = new Set(dropdownTexts).size !== dropdownTexts.length;
      if (hasDuplicates) {
          alert('Duplicate dropdown selections are not allowed. Please select unique options.');
          return; // Prevent submission
      }
      // Check across all cards if any dropdown value is repeated
      const allDropdowns = this.submittedCards.flatMap(card => card.dropdown);
      const hasCommonValues = dropdownTexts.some((value: any) => allDropdowns.includes(value));

      if (hasCommonValues) {
          this.duplicateSubmissionError = true; // Set the error flag
          // alert('Duplicate values detected across cards. Please choose unique values.');
          return; // Prevent submission
      } 
      else {
          this.duplicateSubmissionError = false; // Reset the error flag if no duplicates
      }
      // Handle card update or addition
      if (this.editingIndex !== null) {
          this.submittedCards[this.editingIndex] = {
              name: cardValue.name,
              dropdown: dropdownTexts,
              date: cardValue.date,
              uploadfile: this.fileNames[index] || 'No file uploaded',
              filePreview: this.filePreviews[index] || '',
          };
          this.editingIndex = null;
      } else {
          this.submittedCards.push({
              name: cardValue.name,
              dropdown: dropdownTexts,
              date: cardValue.date,
              uploadfile: this.fileNames[index] || 'No file uploaded',
              filePreview: this.filePreviews[index] || ''
          });
      }

      // Reset the form after submission
      this.cards[index].reset({
          name: '',
          dropdown: [],
          date: ''
      });

      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';

      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
          fileInput.value = '';
      }
  }
}

editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;

    // Set the selected items based on the dropdown values from the submitted card
    this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
      return this.dropdownList.find(item => item.item_text === itemText);
    }).filter((item: undefined) => item !== undefined);

    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
      date: cardToEdit.date
    });

    this.fileNames[0] = cardToEdit.uploadfile || '';
    this.filePreviews[0] = cardToEdit.filePreview || '';
  }

  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}

Disable options that have already been submitted like the refrece code but i want to disable on if it's been submitted already and check for submitted card section if that option submitted already
and give full updated code

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null; 

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

//Dropdownlist Initializer 
  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' }
    ];
  }

//Dropdown Compare 
  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

// 
isOptionDisabled(option: DropdownItem): boolean {
  // Check if this option is already part of any submitted card's dropdown values
  return this.submittedCards.some(card => 
    card.dropdown.includes(option.item_text) // Match against the 'item_text'
  );
}

  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    const selectedItemIds = this.selectedItems[index].map((i: { item_id: any; }) => i.item_id);
    this.cards[index].get('dropdown')?.setValue(selectedItemIds);
    // Reset the duplicate submission error if the user selects a new option
    // this.duplicateSubmissionError = false;
    // clear the touched state if needed
    this.cards[index].get('dropdown')?.markAsUntouched();
}

//Form Validators 
  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', [Validators.required, this.uniqueNameValidator(this.submittedCards), this.nonumber(this.submittedCards)]],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

   // Custom validator to check if the name contains --number-- in the submitted cards
  nonumber(_submittedCards: any[]): (control: AbstractControl) => ValidationErrors | null {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null; 
      }
      const hasNumber = /\d/.test(control.value);
      return hasNumber ? { hasNumber: true } : null;
    };
  }
  
  // Custom validator to check if the --name-- already exists
  uniqueNameValidator(submittedCards: any[]): any {
      return (control: AbstractControl): ValidationErrors | null => {
        if (!control.value) {
          return null;
        }
        const nameExists = submittedCards.some(card => card.name === control.value);
        return nameExists ? { nameTaken: true } : null;
      };
    }

//Main card
  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
        // Check if the file name already exists in submitted cards
        const fileNameExists = this.submittedCards.some(card => card.uploadfile === file.name);
        if (fileNameExists) {
            alert('This file has already been uploaded. Please choose a different file.');
            // Clear the input
            event.target.value = '';
            return;
        }
        this.fileNames[index] = file.name;
        const reader = new FileReader();
        reader.onload = (e: any) => {
            this.filePreviews[index] = e.target.result;
        };
        reader.readAsDataURL(file);
    }
}

  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif',].includes(fileExtension ?? '');
  }

  // duplicateSubmissionError: boolean = false; 

submit(index: number) {
  // Manually mark all controls as touched to trigger validation
  const controls = this.cards[index].controls;
  for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
          controls[control].markAsTouched();
      }
  }

  // Check if the dropdown is empty
  if (this.cards[index].get('dropdown')?.invalid) {
      return; // Prevent submission if dropdown is invalid
  }

  // If the form is valid and the dropdown is valid, check for duplicate submission
  if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
          return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });
      
      if (this.editingIndex !== null) {
          this.submittedCards[this.editingIndex] = {
              name: cardValue.name,
              dropdown: dropdownTexts,
              date: cardValue.date,
              uploadfile: this.fileNames[index] || 'No file uploaded',
              filePreview: this.filePreviews[index] || '',
          };
          this.editingIndex = null;
      } else {
          this.submittedCards.push({
              name: cardValue.name,
              dropdown: dropdownTexts,
              date: cardValue.date,
              uploadfile: this.fileNames[index] || 'No file uploaded',
              filePreview: this.filePreviews[index] || ''
          });
      }

      // Reset the form after submission
      this.cards[index].reset({
          name: '',
          dropdown: [],
          date: ''
      });

      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';

      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
          fileInput.value = '';
      }
  }
}

editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;

    // Set the selected items based on the dropdown values from the submitted card
    this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
      return this.dropdownList.find(item => item.item_text === itemText);
    }).filter((item: undefined) => item !== undefined);

    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
      date: cardToEdit.date
    });

    this.fileNames[0] = cardToEdit.uploadfile || '';
    this.filePreviews[0] = cardToEdit.filePreview || '';
  }

  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}


<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">

          <!-- Name Field -->
          <div class="form-group">
            <label>Name
              <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span>
            </label>
            <input formControlName="name" class="form-control"
              [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}"
              [placeholder]="card.get('name')?.invalid && card.get('name')?.touched ? 'Name is required' : 'Enter name'" />
            <div *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">
              <div *ngIf="card.get('name')?.hasError('required')">Please enter a name.</div>
              <div *ngIf="card.get('name')?.hasError('nameTaken')">This name is already taken.</div>
              <div *ngIf="card.get('name')?.hasError('hasNumber')">Numbers can't be used as names.</div>
            </div>
          </div>
          </div>
          
          <!-- Dropdown Field-->
          <div class="form-group dropdownfield">
            <label>Dropdown
              <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
            </label>
            <ng-select [items]="dropdownList" bindLabel="item_text" bindValue="item_id" [(ngModel)]="selectedItems[i]"
              [multiple]="true" placeholder="Select options" (change)="onItemSelect($event, i)" [clearable]="true"
              [closeOnSelect]="true" [ngModelOptions]="{standalone: true}" [compareWith]="compareWith">
              <ng-option *ngFor="let option of dropdownList" [value]="option.item_id"
                [disabled]="isOptionDisabled(option)">
                {{ option.item_text }}
              </ng-option>
            </ng-select>
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>

          <!-- Date Field -->
          <div class="form-group">
            <label>Date
              <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span>
            </label>
            <input type="date" formControlName="date" class="form-control"
              [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"
              [placeholder]="card.get('date')?.invalid && card.get('date')?.touched ? 'Date is required' : ''" />
            <div *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">
              Please select a date.
            </div>
          </div>

          <!-- Upload File Section -->
          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile"
              [attr.data-index]="i" [placeholder]="fileNames[i] ? 'File uploaded' : 'Please upload a file'"
              class="form-control" />
            <div
              *ngIf="!fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched"
              class="text-danger">
              Please upload a file.
            </div>

            <!-- Display File Preview if available -->
            <div *ngIf="filePreviews[i]" class="mt-2">
              <img [src]="filePreviews[i]" alt="File preview" class="img-fluid" />
              <p><strong>File Name:</strong> {{ fileNames[i] }}</p>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button>
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Submitted Cards Section -->
  <div class="mt-4">
    <h3>Submitted Cards</h3>
    <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
      <div class="card-body">
        <p><strong>Card {{ j + 1 }}</strong></p>
        <p>Name: {{ submittedCard.name }}</p>
        <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
        <p>Date: {{ submittedCard.date | date:'dd/MM/yyyy'}}</p>

        <!-- Display uploaded file name -->
        <div *ngIf="submittedCard.uploadfile">
          <p><strong>Uploaded File:</strong> {{ submittedCard.uploadfile }}</p>
        </div>

        <!-- Show file preview if available -->
        <div *ngIf="submittedCard.filePreview">
          <img [src]="submittedCard.filePreview" alt="File preview" class="img-fluid" />
        </div>

        <!-- Edit Button -->
        <button type="button" class="btn btn-warning ed-bt mt-3 " (click)="editSelectedCard(j)">
          Edit
        </button>

        <!-- Delete Button -->
        <button type="button" class="btn btn-danger det-bt mt-3 " (click)="deleteSelectedCard(j)">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>



<!-- in this code i am uanable to select option from dropdown fix that  -->

    <!-- Dropdown Field -->
    <div class="form-group dropdownfield">
      <label>Dropdown
        <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
      </label>
      <ng-select 
      [items]="getAvailableOptionsForCard(i)" 
      bindLabel="item_text" 
      bindValue="item_id" 
      [(ngModel)]="selectedItems[i]"
      [multiple]="true" 
      placeholder="Select options" 
      (change)="onItemSelect($event, i)" 
      [clearable]="true"
      [closeOnSelect]="true" 
      [ngModelOptions]="{standalone: true}" 
      [compareWith]="compareWith">
      <ng-option *ngFor="let option of getAvailableOptionsForCard(i)" 
                 [value]="option.item_id">
        {{ option.item_text }}
      </ng-option>
    </ng-select>          
      <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
        Please select at least one option.
      </div>
    </div>


    import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})

export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null;

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

  // Dropdown list initialization
  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' },
      { item_id: 4, item_text: 'Option 4' }
    ];
  }

  // Compare function to handle object comparison in ng-select
  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  // Generate available options dynamically for each card
  getAvailableOptionsForCard(_cardIndex: number): DropdownItem[] {
    const selectedOptions = new Set<string>();

    // Add already selected options from other submitted cards to the set
    this.submittedCards.forEach(card => {
      card.dropdown.forEach((option: string) => {
        selectedOptions.add(option);
      });
    });

    // Now filter the dropdownList based on the selected options
    return this.dropdownList.filter(option => !selectedOptions.has(option.item_text));
  }

  // Handle the selection in the dropdown
  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    const selectedItemIds = this.selectedItems[index].map((i: { item_id: any; }) => i.item_id);
    this.cards[index].get('dropdown')?.setValue(selectedItemIds);
    this.cards[index].get('dropdown')?.markAsUntouched();
  }

  // Form creation and validation
  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', [Validators.required, this.uniqueNameValidator(this.submittedCards), this.nonumber()]],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

  // Validator to ensure names do not contain numbers
  nonumber(): (control: AbstractControl) => ValidationErrors | null {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null; 
      }
      const hasNumber = /\d/.test(control.value);
      return hasNumber ? { hasNumber: true } : null;
    };
  }

  // Custom validator to check if the name already exists
  uniqueNameValidator(submittedCards: any[]): any {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null;
      }
      const nameExists = submittedCards.some(card => card.name === control.value);
      return nameExists ? { nameTaken: true } : null;
    };
  }

  // Add a new card
  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  // Delete a card
  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  // Handle file input and prevent duplicate file uploads
  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      const fileNameExists = this.submittedCards.some(card => card.uploadfile === file.name);
      if (fileNameExists) {
        alert('This file has already been uploaded. Please choose a different file.');
        event.target.value = '';
        return;
      }
      this.fileNames[index] = file.name;
      const reader = new FileReader();
      reader.onload = (e: any) => {
        this.filePreviews[index] = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  }

  // Check if a file is an image
  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension ?? '');
  }

  // Submit a card
  submit(index: number) {
    const controls = this.cards[index].controls;
    for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
        controls[control].markAsTouched();
      }
    }

    if (this.cards[index].get('dropdown')?.invalid) {
      return;
    }

    if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
        return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });
      
      if (this.editingIndex !== null) {
        // Edit mode: Update the existing card in the submittedCards array
        this.submittedCards[this.editingIndex] = {
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || '',
        };
        this.editingIndex = null;
      } else {
        // New card: Add it to the submittedCards array
        this.submittedCards.push({
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || ''
        });
      }

      // Reset the form after submission
      this.cards[index].reset({
        name: '',
        dropdown: [],
        date: ''
      });

      // Clear the selected items and file inputs
      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';

      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
        fileInput.value = '';
      }
    }
  }

  // Edit an existing card
  editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;

    this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
      return this.dropdownList.find(item => item.item_text === itemText);
    }).filter((item: undefined) => item !== undefined);

    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
      date: cardToEdit.date
    });

    this.fileNames[0] = cardToEdit.uploadfile || '';
    this.filePreviews[0] = cardToEdit.filePreview || '';
  }

  // Delete a submitted card
  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}


i am not able to select dropdown option fix that

<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">

          <!-- Name Field -->
          <div class="form-group">
            <label>Name
              <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span>
            </label>
            <input formControlName="name" class="form-control"
              [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}"
              [placeholder]="card.get('name')?.invalid && card.get('name')?.touched ? 'Name is required' : 'Enter name'" />
            <div *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">
              <div *ngIf="card.get('name')?.hasError('required')">Please enter a name.</div>
              <div *ngIf="card.get('name')?.hasError('hasNumber')">Numbers can't be used as names.</div>
            </div>
          </div>

          <!-- Dropdown Field -->
          <div class="form-group dropdownfield">
            <label>Dropdown
              <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
            </label>
            <ng-select 
            [items]="getAvailableOptionsForCard(i)" 
            bindLabel="item_text" 
            bindValue="item_id" 
            [(ngModel)]="selectedItems[i]"
            [multiple]="true" 
            placeholder="Select options" 
            (change)="onItemSelect($event, i)" 
            [clearable]="true"
            [closeOnSelect]="true" 
            [ngModelOptions]="{standalone: true}" 
            [compareWith]="compareWith">
            <ng-option *ngFor="let option of getAvailableOptionsForCard(i)" 
                       [value]="option.item_id">
              {{ option.item_text }}
            </ng-option>
          </ng-select>          
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>

          <!-- Date Field -->
          <div class="form-group">
            <label>Date
              <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span>
            </label>
            <input type="date" formControlName="date" class="form-control"
              [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"
              [placeholder]="card.get('date')?.invalid && card.get('date')?.touched ? 'Date is required' : ''" />
            <div *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">
              Please select a date.
            </div>
          </div>

          <!-- Upload File Section -->
          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile"
              [attr.data-index]="i" [placeholder]="fileNames[i] ? 'File uploaded' : 'Please upload a file'"
              class="form-control" />
            <div *ngIf="!fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched"
              class="text-danger">
              Please upload a file.
            </div>

            <!-- Display File Preview if available -->
            <div *ngIf="filePreviews[i]" class="mt-2">
              <img [src]="filePreviews[i]" alt="File preview" class="img-fluid" />
              <p><strong>File Name:</strong> {{ fileNames[i] }}</p>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button>
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Submitted Cards Section -->
  <div class="mt-4">
    <h3>Submitted Cards</h3>
    <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
      <div class="card-body">
        <p><strong>Card {{ j + 1 }}</strong></p>
        <p>Name: {{ submittedCard.name }}</p>
        <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
        <p>Date: {{ submittedCard.date | date:'dd/MM/yyyy'}}</p>

        <!-- Display uploaded file name -->
        <div *ngIf="submittedCard.uploadfile">
          <p><strong>Uploaded File:</strong> {{ submittedCard.uploadfile }}</p>
        </div>

        <!-- Show file preview if available -->
        <div *ngIf="submittedCard.filePreview">
          <img [src]="submittedCard.filePreview" alt="File preview" class="img-fluid" />
        </div>

        <!-- Edit Button -->
        <button type="button" class="btn btn-warning ed-bt mt-3 " (click)="editSelectedCard(j)">
          Edit
        </button>

        <!-- Delete Button -->
        <button type="button" class="btn btn-danger det-bt mt-3 " (click)="deleteSelectedCard(j)">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})
export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null;

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

  // Dropdown list initialization
  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' },
      { item_id: 4, item_text: 'Option 4' }
    ];
  }

  // Compare function to handle object comparison in ng-select
  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  // Generate available options dynamically for each card
  getAvailableOptionsForCard(cardIndex: number): DropdownItem[] {
    const selectedOptions = new Set<string>();

    // Add already selected options from other submitted cards to the set
    this.submittedCards.forEach(card => {
      card.dropdown.forEach((option: string) => {
        selectedOptions.add(option);
      });
    });

    // Now filter the dropdownList based on the selected options
    return this.dropdownList.filter(option => !selectedOptions.has(option.item_text));
  }

  // Handle the selection in the dropdown
  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    const selectedItemIds = this.selectedItems[index].map((i: { item_id: any; }) => i.item_id);
    this.cards[index].get('dropdown')?.setValue(selectedItemIds);
    this.cards[index].get('dropdown')?.markAsUntouched();
  }

  // Form creation and validation
  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', [Validators.required, this.uniqueNameValidator(this.submittedCards), this.nonumber()]],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

  // Validator to ensure names do not contain numbers
  nonumber(): (control: AbstractControl) => ValidationErrors | null {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null; 
      }
      const hasNumber = /\d/.test(control.value);
      return hasNumber ? { hasNumber: true } : null;
    };
  }

  // Custom validator to check if the name already exists
  uniqueNameValidator(submittedCards: any[]): any {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null;
      }
      const nameExists = submittedCards.some(card => card.name === control.value);
      return nameExists ? { nameTaken: true } : null;
    };
  }

  // Add a new card
  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  // Delete a card
  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  // Handle file input and prevent duplicate file uploads
  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      const fileNameExists = this.submittedCards.some(card => card.uploadfile === file.name);
      if (fileNameExists) {
        alert('This file has already been uploaded. Please choose a different file.');
        event.target.value = '';
        return;
      }
      this.fileNames[index] = file.name;
      const reader = new FileReader();
      reader.onload = (e: any) => {
        this.filePreviews[index] = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  }

  // Check if a file is an image
  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension ?? '');
  }

  // Submit a card
  submit(index: number) {
    const controls = this.cards[index].controls;
    for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
        controls[control].markAsTouched();
      }
    }

    if (this.cards[index].get('dropdown')?.invalid) {
      return;
    }

    if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
        return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });
      
      if (this.editingIndex !== null) {
        // Edit mode: Update the existing card in the submittedCards array
        this.submittedCards[this.editingIndex] = {
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || '',
        };
        this.editingIndex = null;
      } else {
        // New card: Add it to the submittedCards array
        this.submittedCards.push({
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || ''
        });
      }

      // Reset the form after submission
      this.cards[index].reset({
        name: '',
        dropdown: [],
        date: ''
      });

      // Clear the selected items and file inputs
      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';

      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
        fileInput.value = '';
      }
    }
  }

  // Edit an existing card
  editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;

    this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
      return this.dropdownList.find(item => item.item_text === itemText);
    }).filter((item: undefined) => item !== undefined);

    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
      date: cardToEdit.date
    });

    this.fileNames[0] = cardToEdit.uploadfile || '';
    this.filePreviews[0] = cardToEdit.filePreview || '';
  }

  // Delete a submitted card
  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}

//check why i am only able to select options from in dev mode and not without dev mode it's not selecting
<div class="container mt-4 main-card">
  <h2>Some Cards</h2>
  <div class="mt-4 added-card">
    <div *ngFor="let card of cards; let i = index" class="card mb-2">
      <div class="card-body">
        <form [formGroup]="card" (ngSubmit)="submit(i)">

          <!-- Name Field -->
          <div class="form-group">
            <label>Name
              <span *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">*</span>
            </label>
            <input formControlName="name" class="form-control"
              [ngClass]="{'is-invalid': card.get('name')?.invalid && card.get('name')?.touched}"
              [placeholder]="card.get('name')?.invalid && card.get('name')?.touched ? 'Name is required' : 'Enter name'" />
            <div *ngIf="card.get('name')?.invalid && card.get('name')?.touched" class="text-danger">
              <div *ngIf="card.get('name')?.hasError('required')">Please enter a name.</div>
              <div *ngIf="card.get('name')?.hasError('hasNumber')">Numbers can't be used as names.</div>
            </div>
          </div>

          <!-- Dropdown Field -->
          <div class="form-group dropdownfield">
            <label>Dropdown
              <span *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">*</span>
            </label>
            <ng-select 
            [items]="getAvailableOptionsForCard(i)" 
            bindLabel="item_text" 
            bindValue="item_id" 
            [(ngModel)]="selectedItems[i]"
            [multiple]="true" 
            placeholder="Select options" 
            (change)="onItemSelect($event, i)" 
            [clearable]="true"
            [closeOnSelect]="true" 
            [ngModelOptions]="{standalone: true}" 
            [compareWith]="compareWith">
            <ng-option *ngFor="let option of getAvailableOptionsForCard(i)" 
                       [value]="option.item_id">
              {{ option.item_text }}
            </ng-option>
          </ng-select>          
            <div *ngIf="card.get('dropdown')?.invalid && card.get('dropdown')?.touched" class="text-danger">
              Please select at least one option.
            </div>
          </div>

          <!-- Date Field -->
          <div class="form-group">
            <label>Date
              <span *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">*</span>
            </label>
            <input type="date" formControlName="date" class="form-control"
              [ngClass]="{'is-invalid': card.get('date')?.invalid && card.get('date')?.touched}"
              [placeholder]="card.get('date')?.invalid && card.get('date')?.touched ? 'Date is required' : ''" />
            <div *ngIf="card.get('date')?.invalid && card.get('date')?.touched" class="text-danger">
              Please select a date.
            </div>
          </div>

          <!-- Upload File Section -->
          <div class="form-group">
            <label for="myfile-{{i}}">Upload File</label>
            <input type="file" (change)="handleFileInput($event, i)" id="myfile-{{i}}" name="myfile"
              [attr.data-index]="i" [placeholder]="fileNames[i] ? 'File uploaded' : 'Please upload a file'"
              class="form-control" />
            <div *ngIf="!fileNames[i] && card.get('name')?.touched && card.get('dropdown')?.touched && card.get('date')?.touched"
              class="text-danger">
              Please upload a file.
            </div>

            <!-- Display File Preview if available -->
            <div *ngIf="filePreviews[i]" class="mt-2">
              <img [src]="filePreviews[i]" alt="File preview" class="img-fluid" />
              <p><strong>File Name:</strong> {{ fileNames[i] }}</p>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="btns">
            <button type="button" class="btn btn-danger dt-bt" (click)="deleteCard(i)">Delete</button>
            <button type="button" class="btn btn-primary mt-3 ad-bt" (click)="addCard()">Add Card</button>
            <button type="submit" class="btn btn-primary mt-3 st-bt">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Submitted Cards Section -->
  <div class="mt-4">
    <h3>Submitted Cards</h3>
    <div *ngFor="let submittedCard of submittedCards; let j = index" class="card mb-2">
      <div class="card-body">
        <p><strong>Card {{ j + 1 }}</strong></p>
        <p>Name: {{ submittedCard.name }}</p>
        <p>Dropdown: {{ submittedCard.dropdown | json }}</p>
        <p>Date: {{ submittedCard.date | date:'dd/MM/yyyy'}}</p>

        <!-- Display uploaded file name -->
        <div *ngIf="submittedCard.uploadfile">
          <p><strong>Uploaded File:</strong> {{ submittedCard.uploadfile }}</p>
        </div>

        <!-- Show file preview if available -->
        <div *ngIf="submittedCard.filePreview">
          <img [src]="submittedCard.filePreview" alt="File preview" class="img-fluid" />
        </div>

        <!-- Edit Button -->
        <button type="button" class="btn btn-warning ed-bt mt-3 " (click)="editSelectedCard(j)">
          Edit
        </button>

        <!-- Delete Button -->
        <button type="button" class="btn btn-danger det-bt mt-3 " (click)="deleteSelectedCard(j)">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors } from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { NgSelectModule } from '@ng-select/ng-select';

interface DropdownItem {
  item_id: number;
  item_text: string;
}

@Component({
  selector: 'app-form-card',
  standalone: true,
  imports: [FormsModule, CommonModule, ReactiveFormsModule, NgSelectModule],
  templateUrl: './form-card.component.html',
  styleUrls: ['./form-card.component.css']
})
export class FormCardComponent implements OnInit {
  cards: FormGroup[] = [];
  submittedCards: any[] = [];
  dropdownList: DropdownItem[] = [];
  selectedItems: any[] = [];
  fileNames: string[] = [];
  filePreviews: string[] = [];  
  editingIndex: number | null = null;

  constructor(private fb: FormBuilder) {  
    this.addCard();  
  }

  // Dropdown list initialization
  ngOnInit() {
    this.dropdownList = [
      { item_id: 1, item_text: 'Option 1' },
      { item_id: 2, item_text: 'Option 2' },
      { item_id: 3, item_text: 'Option 3' },
      { item_id: 4, item_text: 'Option 4' }
    ];
  }

  // Compare function to handle object comparison in ng-select
  compareWith(item1: DropdownItem, item2: DropdownItem): boolean {
    return item1 && item2 ? item1.item_id === item2.item_id : item1 === item2;
  }

  // Generate available options dynamically for each card
  getAvailableOptionsForCard(_cardIndex: number): DropdownItem[] {
    const selectedOptions = new Set<string>();

    // Add already selected options from other submitted cards to the set
    this.submittedCards.forEach(card => {
      card.dropdown.forEach((option: string) => {
        selectedOptions.add(option);
      });
    });

    // Now filter the dropdownList based on the selected options
    return this.dropdownList.filter(option => !selectedOptions.has(option.item_text));
  }

  // Handle the selection in the dropdown
  onItemSelect(item: any, index: number) {
    this.selectedItems[index] = item;
    const selectedItemIds = this.selectedItems[index].map((i: { item_id: any; }) => i.item_id);
    this.cards[index].get('dropdown')?.setValue(selectedItemIds);
    this.cards[index].get('dropdown')?.markAsUntouched();
  }

  // Form creation and validation
  createCardForm(): FormGroup {
    return this.fb.group({
      name: ['', [Validators.required, this.uniqueNameValidator(this.submittedCards), this.nonumber()]],
      dropdown: [[], Validators.required],
      date: ['', Validators.required],
    });
  }

  // Validator to ensure names do not contain numbers
  nonumber(): (control: AbstractControl) => ValidationErrors | null {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null; 
      }
      const hasNumber = /\d/.test(control.value);
      return hasNumber ? { hasNumber: true } : null;
    };
  }

  // Custom validator to check if the name already exists
  uniqueNameValidator(submittedCards: any[]): any {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) {
        return null;
      }
      const nameExists = submittedCards.some(card => card.name === control.value);
      return nameExists ? { nameTaken: true } : null;
    };
  }

  // Add a new card
  addCard() {
    const newCard = this.createCardForm();
    this.cards.push(newCard);
    this.selectedItems.push([]); 
    this.fileNames.push('');
    this.filePreviews.push('');  
  }

  // Delete a card
  deleteCard(index: number) {
    if (index === 0) {
      return; // Main card can't be deleted
    }
    this.cards.splice(index, 1);
    this.selectedItems.splice(index, 1);  
    this.fileNames.splice(index, 1); 
    this.filePreviews.splice(index, 1);
  }

  // Handle file input and prevent duplicate file uploads
  handleFileInput(event: any, index: number) {
    const file = event.target.files[0];
    if (file) {
      const fileNameExists = this.submittedCards.some(card => card.uploadfile === file.name);
      if (fileNameExists) {
        alert('This file has already been uploaded. Please choose a different file.');
        event.target.value = '';
        return;
      }
      this.fileNames[index] = file.name;
      const reader = new FileReader();
      reader.onload = (e: any) => {
        this.filePreviews[index] = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  }

  // Check if a file is an image
  isImageFile(fileName: string): boolean {
    const fileExtension = fileName.split('.').pop()?.toLowerCase();
    return ['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension ?? '');
  }

  // Submit a card
  submit(index: number) {
    const controls = this.cards[index].controls;
    for (const control in controls) {
      if (controls.hasOwnProperty(control)) {
        controls[control].markAsTouched();
      }
    }

    if (this.cards[index].get('dropdown')?.invalid) {
      return;
    }

    if (this.cards[index].valid && !this.cards[index].get('name')?.hasError('nameTaken')) {
      const cardValue = this.cards[index].value;
      const dropdownTexts = cardValue.dropdown.map((id: number) => {
        return this.dropdownList.find(item => item.item_id === id)?.item_text;
      });
      
      if (this.editingIndex !== null) {
        // Edit mode: Update the existing card in the submittedCards array
        this.submittedCards[this.editingIndex] = {
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || '',
        };
        this.editingIndex = null;
      } else {
        // New card: Add it to the submittedCards array
        this.submittedCards.push({
          name: cardValue.name,
          dropdown: dropdownTexts,
          date: cardValue.date,
          uploadfile: this.fileNames[index] || 'No file uploaded',
          filePreview: this.filePreviews[index] || ''
        });
      }

      // Reset the form after submission
      this.cards[index].reset({
        name: '',
        dropdown: [],
        date: ''
      });

      // Clear the selected items and file inputs
      this.selectedItems[index] = [];
      this.fileNames[index] = ''; 
      this.filePreviews[index] = '';

      const fileInput = document.querySelector(`input[type="file"][data-index="${index}"]`) as HTMLInputElement;
      if (fileInput) {
        fileInput.value = '';
      }
    }
  }

  // Edit an existing card
  editSelectedCard(index: number) {
    const cardToEdit = this.submittedCards[index];
    this.editingIndex = index;

    this.selectedItems[0] = cardToEdit.dropdown.map((itemText: string) => {
      return this.dropdownList.find(item => item.item_text === itemText);
    }).filter((item: undefined) => item !== undefined);

    this.cards[0].patchValue({
      name: cardToEdit.name,
      dropdown: this.selectedItems[0].map((item: { item_id: any; }) => item.item_id),
      date: cardToEdit.date
    });

    this.fileNames[0] = cardToEdit.uploadfile || '';
    this.filePreviews[0] = cardToEdit.filePreview || '';
  }

  // Delete a submitted card
  deleteSelectedCard(index: number) {
    this.submittedCards.splice(index, 1);
  }
}
